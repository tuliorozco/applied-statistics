
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Implementación de Modelos &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'c03_proyectoFinal/diabetes_classifier_model';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="EDA- PROYECTO FINAL" href="diabetes_classifier_eda.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    About me
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../c01_miniproyecto_KNN/knn_intro.html">K-Nearest Neighbors (KNN): Predicción del Éxito Académico y Riesgo de Deserción en Estudiantes Universitarios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c01_miniproyecto_KNN/knn_eda.html">Análisis Exploratorio y Visualización</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01_miniproyecto_KNN/knn_miniproyecto.html">Mini Proyecto #1:</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="diabetes_classifier_abstract.html">Clasificación de Riesgo en Pacientes con Diabetes: Comparativa de Modelos Clásicos de Machine Learning Frente a Propuesta de Modelo Híbrido</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="diabetes_classifier_eda.html">EDA- PROYECTO FINAL</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Implementación de Modelos</a></li>

</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fc03_proyectoFinal/diabetes_classifier_model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/c03_proyectoFinal/diabetes_classifier_model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Implementación de Modelos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Implementación de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-y-preprocesamiento-de-datos">Carga y Preprocesamiento de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia">Metodología</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacion-del-grid-de-hiperparametros-por-tipo-de-modelo">Especificación del Grid de Hiperparámetros por Tipo de Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento-algoritmos-clasicos">Entrenamiento: Algoritmos Clásicos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-y-benchmark">Resultados y <em>Benchmark</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-metricas-de-performance">Evaluación de Métricas de Performance</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="implementacion-de-modelos">
<h1>Implementación de Modelos<a class="headerlink" href="#implementacion-de-modelos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">graphviz</span>


<span class="c1"># Utilidades pre-procesamiento, pipelines y automatización de entrenamiento</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">train_test_split</span><span class="p">,</span> 
    <span class="n">cross_val_score</span><span class="p">,</span> 
    <span class="n">KFold</span><span class="p">,</span> 
    <span class="n">StratifiedKFold</span><span class="p">,</span> 
    <span class="n">GridSearchCV</span>
    <span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="c1"># from sklearn.impute import SimpleImputer</span>

<span class="c1"># Métricas de performance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">classification_report</span><span class="p">,</span>
    <span class="n">accuracy_score</span><span class="p">,</span> 
    <span class="n">precision_score</span><span class="p">,</span> 
    <span class="n">recall_score</span><span class="p">,</span> 
    <span class="n">f1_score</span><span class="p">,</span> 
    <span class="n">roc_auc_score</span><span class="p">,</span> 
    <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span>
    <span class="n">confusion_matrix</span>
<span class="p">)</span>

<span class="c1"># Modelos</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src</span><span class="w"> </span><span class="kn">import</span> <span class="n">TopKTabularMoE</span> <span class="k">as</span> <span class="n">tkm</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.trainClassifiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_LogisticRegression</span> <span class="c1"># Custom LogisticRegression para evaluar en multiples tresholds.</span>

<span class="c1"># Diccionario con el grid de algoritmos y especificación de sus respectivos hiperparámetros</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src</span><span class="w"> </span><span class="kn">import</span> <span class="n">benchmark_models</span>


<span class="c1"># Utilidades</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">missingno</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">msno</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="carga-y-preprocesamiento-de-datos">
<h2>Carga y Preprocesamiento de datos<a class="headerlink" href="#carga-y-preprocesamiento-de-datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importación de los datos</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/tuliorozco/applied-statistics/refs/heads/main/data/diabetes_dataset.csv&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>gender</th>
      <th>age</th>
      <th>location</th>
      <th>race:AfricanAmerican</th>
      <th>race:Asian</th>
      <th>race:Caucasian</th>
      <th>race:Hispanic</th>
      <th>race:Other</th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>smoking_history</th>
      <th>bmi</th>
      <th>hbA1c_level</th>
      <th>blood_glucose_level</th>
      <th>diabetes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020</td>
      <td>Female</td>
      <td>32.0</td>
      <td>Alabama</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>never</td>
      <td>27.32</td>
      <td>5.0</td>
      <td>100</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015</td>
      <td>Female</td>
      <td>29.0</td>
      <td>Alabama</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>never</td>
      <td>19.95</td>
      <td>5.0</td>
      <td>90</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015</td>
      <td>Male</td>
      <td>18.0</td>
      <td>Alabama</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>never</td>
      <td>23.76</td>
      <td>4.8</td>
      <td>160</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015</td>
      <td>Male</td>
      <td>41.0</td>
      <td>Alabama</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>never</td>
      <td>27.32</td>
      <td>4.0</td>
      <td>159</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016</td>
      <td>Female</td>
      <td>52.0</td>
      <td>Alabama</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>never</td>
      <td>23.75</td>
      <td>6.5</td>
      <td>90</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================== PREPROCESAMIENTO ===================================</span>

<span class="c1"># Eliminación de observaciones duplicadas</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nuevo total de registros: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># 1. Separar las features predictoras (X) de la variable objetivo/target (y).</span>
<span class="n">TARGET_COL</span> <span class="o">=</span> <span class="s1">&#39;diabetes&#39;</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;diabetes&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span>

<span class="c1"># 2. Clasificar los campos por tipo de variable para el pre-procesamiento adecuado</span>
<span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;bmi&quot;</span><span class="p">,</span> <span class="s2">&quot;hbA1c_level&quot;</span><span class="p">,</span> <span class="s2">&quot;blood_glucose_level&quot;</span><span class="p">]</span> 

<span class="n">binary_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;race:AfricanAmerican&#39;</span><span class="p">,</span><span class="s1">&#39;race:Asian&#39;</span><span class="p">,</span><span class="s1">&#39;race:Caucasian&#39;</span><span class="p">,</span>
               <span class="s1">&#39;race:Hispanic&#39;</span><span class="p">,</span><span class="s1">&#39;race:Other&#39;</span><span class="p">,</span><span class="s1">&#39;hypertension&#39;</span><span class="p">,</span><span class="s1">&#39;heart_disease&#39;</span><span class="p">]</span> 


<span class="n">categorical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">numerical_cols</span> <span class="o">+</span> <span class="n">binary_cols</span><span class="p">]</span>
<span class="n">categorical_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;diabetes&#39;</span><span class="p">)</span> 


<span class="c1"># 3. División Train/Test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>


<span class="c1"># 4. Pre-procesamiento de los datos</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">categorical_cols</span><span class="p">),</span>  
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numerical_cols</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">,</span> <span class="n">binary_cols</span><span class="p">)</span>  
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nuevo total de registros: 99986
(99986, 16)
</pre></div>
</div>
</div>
</div>
</section>
<section id="metodologia">
<h2>Metodología<a class="headerlink" href="#metodologia" title="Link to this heading">#</a></h2>
<section id="especificacion-del-grid-de-hiperparametros-por-tipo-de-modelo">
<h3>Especificación del Grid de Hiperparámetros por Tipo de Modelo<a class="headerlink" href="#especificacion-del-grid-de-hiperparametros-por-tipo-de-modelo" title="Link to this heading">#</a></h3>
<p>Teniendo en cuenta que los modelos a entrenar y analizar pueden ser ejecutados de forma automática mediante <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> (A excepción del algoritmo propuesto), se especificará un diccionario <em>models_config</em> estructurado de la siguiente forma:</p>
<ul class="simple">
<li><p>Key (clave): Identificación del tipo de algoritmo, ejemplo: KNN, LogisticRegresion, DecisionTree, etc.</p></li>
<li><p>Value (valor): El conjunto de funciones (la implementación de cada algortimo en los paquetes <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> o <code class="docutils literal notranslate"><span class="pre">xgboost</span></code>), los parámetros de inicialización del algoritmo (si los tiene) y sus respectivos hiperparámetros a evaluar en el entrenamiento.</p></li>
</ul>
<p>En la especificación se muestra de la siguiente manera:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">models_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;KNN&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">,</span>
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;classifier__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
            <span class="s1">&#39;classifier__weights&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">],</span>
            <span class="s1">&#39;classifier__metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">]</span>
            <span class="p">}</span>   
        <span class="p">}</span> <span class="p">,</span>
         <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">,</span>
            <span class="s1">&#39;init_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">random_state</span><span class="p">},</span> 
            <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span>
                <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">]</span>
            <span class="p">}</span>
         <span class="p">},</span>
    <span class="c1"># Y así sucesivamente ...</span>
    <span class="s1">&#39;MLP&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;function&#39;</span><span class="p">:</span> <span class="n">MLPClassifier</span><span class="p">,</span>
        <span class="s1">&#39;init_params&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">101</span>
        <span class="p">},</span>
        <span class="s1">&#39;param_grid&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;classifier__hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">50</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
            <span class="s1">&#39;classifier__activation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">],</span>
            <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="s1">&#39;sgd&#39;</span><span class="p">],</span>
            <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Así mismo, se define una variable tipo <code class="docutils literal notranslate"><span class="pre">Dict</span></code> denominada <em>common_params</em> con las siguientes <em>key-values</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X_train</span></code>: Variables predictoras del conjunto de entrenamiento.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_test</span></code>: Variables predictoras del conjunto de test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: Variable <em>target</em> del conjunto de entrenamiento.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: Variable <em>target</em> del conjunto de test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv_folds</span></code>: Número de pliegues para la validación cruzada (cross validation).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">random_state</span></code>: Semilla de reproducibilidad.</p></li>
</ul>
</section>
<section id="entrenamiento-algoritmos-clasicos">
<h3>Entrenamiento: Algoritmos Clásicos<a class="headerlink" href="#entrenamiento-algoritmos-clasicos" title="Link to this heading">#</a></h3>
<p>Definidos los algoritmos con sus respectivos hiperparámetros así como los parámetros comunes (conjuntos de entrenamiento y pruebas), se define un bucle <em>for</em> que recorrerá el diccionario y procesará cada algoritmo según lo especificado en <em>models_config</em>. Las métricas resultantes del entrenamiento se almacenarán en listas para el análisis comparativo posterior frente al modelo propuesto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">101</span>


<span class="c1"># Parámetros comunes para el entrenamiento</span>
<span class="n">common_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;X_train&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span>
    <span class="s1">&#39;X_test&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span>
    <span class="s1">&#39;y_train&#39;</span><span class="p">:</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="s1">&#39;y_test&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
    <span class="s1">&#39;cv_folds&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">random_state</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span><span class="p">,</span> <span class="n">best_config_df</span><span class="p">,</span> <span class="n">roc_curves</span> <span class="o">=</span> <span class="n">benchmark_models</span><span class="o">.</span><span class="n">run_benchmark</span><span class="p">(</span>
    <span class="n">common_params</span><span class="o">=</span><span class="n">common_params</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">balance</span><span class="o">=</span><span class="kc">False</span>   <span class="c1"># Sin aplicar remuestreo balanceado mediante SMOTE ni SMOTE-Tomek</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: KNN
Fitting 5 folds for each of 14 candidates, totalling 70 fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_roc_curves</span><span class="p">(</span><span class="n">roc_curves</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grafica curvas ROC a partir del diccionario roc_curves.</span>
<span class="sd">    </span>
<span class="sd">    roc_curves : dict</span>
<span class="sd">        { modelo: (fpr, tpr, roc_auc) }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">roc_curves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> (AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Línea diagonal de azar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;False Positive Rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Curvas ROC comparativas&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_roc_curves</span><span class="p">(</span><span class="n">roc_curves</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/827f366dfa25c5a7632d74c8589d1af7e906c81612d7625c768c63b65bac5644.png" src="../_images/827f366dfa25c5a7632d74c8589d1af7e906c81612d7625c768c63b65bac5644.png" />
</div>
</div>
<p>La figura 1 presenta una comparativa de las curvas ROC-AUC de cada uno de los algoritmos de clasificación analizados. El eje X representa la tasa de falsos positivos (FPR), mientras que el eje Y muestra la tasa de verdaderos positivos (TPR). Los resultados reflejan un buen comportamiento general de los modelos, ya que todos presentan valores de AUC superiores a 0.92, lo que indica un alto poder predictivo. Sin embargo, algunos destacan sobre los demás:</p>
<ul class="simple">
<li><p>XGBoost → Es el modelo con mejor desempeño (AUC = 0.978), logrando la mayor capacidad de discriminación entre clases.</p></li>
<li><p>Decision Tree (AUC = 0.974) y MLP (red neuronal) (AUC = 0.972) → También ofrecen resultados sobresalientes, muy cercanos al rendimiento de XGBoost.</p></li>
<li><p>Random Forest (AUC = 0.964) y SVM (AUC = 0.959) → Mantienen una buena precisión y estabilidad en las predicciones.</p></li>
<li><p>Logistic Regression (AUC = 0.960) → A pesar de ser un modelo más simple, logra un rendimiento competitivo.</p></li>
<li><p>KNN (AUC = 0.929) → Presenta el valor más bajo dentro del conjunto, pero aun así mantiene un desempeño aceptable.
En síntesis, el modelo XGBoost se posiciona como la mejor alternativa para la clasificación de pacientes con y sin diabetes, seguido muy de cerca por Decision Tree y MLP. Estos resultados evidencian que los modelos basados en aprendizaje no lineal y técnicas avanzadas de ensamble ofrecen mayor precisión y confiabilidad para este problema.</p></li>
</ul>
</section>
</section>
<section id="resultados-y-benchmark">
<h2>Resultados y <em>Benchmark</em><a class="headerlink" href="#resultados-y-benchmark" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =================================== METRICAS EN FORMATO TABULAR ===================================</span>


<span class="c1"># Agrupar por métrica y seleccionar el índice del máximo en la columna &#39;Valor&#39;</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">best_config_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Métrica&quot;</span><span class="p">)[</span><span class="s2">&quot;Valor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>

<span class="c1"># Filtrar el DataFrame con esos índices</span>
<span class="n">best_overall_df</span> <span class="o">=</span> <span class="n">best_config_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">35</span> <span class="o">+</span> <span class="s2">&quot;TABLA COMPARATIVA DE RESULTADOS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">results_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>====================================================================================================
                                   TABLA COMPARATIVA DE RESULTADOS
====================================================================================================
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
</style>
<table id="T_02f6d">
  <thead>
    <tr>
      <th id="T_02f6d_level0_col0" class="col_heading level0 col0" >Model</th>
      <th id="T_02f6d_level0_col1" class="col_heading level0 col1" >Precision</th>
      <th id="T_02f6d_level0_col2" class="col_heading level0 col2" >Recall</th>
      <th id="T_02f6d_level0_col3" class="col_heading level0 col3" >F1-Score</th>
      <th id="T_02f6d_level0_col4" class="col_heading level0 col4" >Accuracy</th>
      <th id="T_02f6d_level0_col5" class="col_heading level0 col5" >ROC-AUC</th>
      <th id="T_02f6d_level0_col6" class="col_heading level0 col6" >Best Params</th>
      <th id="T_02f6d_level0_col7" class="col_heading level0 col7" >TN</th>
      <th id="T_02f6d_level0_col8" class="col_heading level0 col8" >TP</th>
      <th id="T_02f6d_level0_col9" class="col_heading level0 col9" >FP</th>
      <th id="T_02f6d_level0_col10" class="col_heading level0 col10" >FN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_02f6d_row0_col0" class="data row0 col0" >KNN</td>
      <td id="T_02f6d_row0_col1" class="data row0 col1" >0.987</td>
      <td id="T_02f6d_row0_col2" class="data row0 col2" >0.522</td>
      <td id="T_02f6d_row0_col3" class="data row0 col3" >0.683</td>
      <td id="T_02f6d_row0_col4" class="data row0 col4" >0.959</td>
      <td id="T_02f6d_row0_col5" class="data row0 col5" >0.929</td>
      <td id="T_02f6d_row0_col6" class="data row0 col6" >{'metric': 'euclidean', 'n_neighbors': 15, 'weights': 'distance'}</td>
      <td id="T_02f6d_row0_col7" class="data row0 col7" >27428</td>
      <td id="T_02f6d_row0_col8" class="data row0 col8" >1331</td>
      <td id="T_02f6d_row0_col9" class="data row0 col9" >18</td>
      <td id="T_02f6d_row0_col10" class="data row0 col10" >1219</td>
    </tr>
    <tr>
      <td id="T_02f6d_row1_col0" class="data row1 col0" >LogisticRegression</td>
      <td id="T_02f6d_row1_col1" class="data row1 col1" >0.875</td>
      <td id="T_02f6d_row1_col2" class="data row1 col2" >0.628</td>
      <td id="T_02f6d_row1_col3" class="data row1 col3" >0.732</td>
      <td id="T_02f6d_row1_col4" class="data row1 col4" >0.961</td>
      <td id="T_02f6d_row1_col5" class="data row1 col5" >0.960</td>
      <td id="T_02f6d_row1_col6" class="data row1 col6" >{'C': 0.1, 'penalty': 'l1', 'solver': 'liblinear'}</td>
      <td id="T_02f6d_row1_col7" class="data row1 col7" >27218</td>
      <td id="T_02f6d_row1_col8" class="data row1 col8" >1602</td>
      <td id="T_02f6d_row1_col9" class="data row1 col9" >228</td>
      <td id="T_02f6d_row1_col10" class="data row1 col10" >948</td>
    </tr>
    <tr>
      <td id="T_02f6d_row2_col0" class="data row2 col0" >DecisionTree</td>
      <td id="T_02f6d_row2_col1" class="data row2 col1" >0.974</td>
      <td id="T_02f6d_row2_col2" class="data row2 col2" >0.676</td>
      <td id="T_02f6d_row2_col3" class="data row2 col3" >0.798</td>
      <td id="T_02f6d_row2_col4" class="data row2 col4" >0.971</td>
      <td id="T_02f6d_row2_col5" class="data row2 col5" >0.974</td>
      <td id="T_02f6d_row2_col6" class="data row2 col6" >{'max_depth': 10, 'min_samples_leaf': 1, 'min_samples_split': 10}</td>
      <td id="T_02f6d_row2_col7" class="data row2 col7" >27400</td>
      <td id="T_02f6d_row2_col8" class="data row2 col8" >1724</td>
      <td id="T_02f6d_row2_col9" class="data row2 col9" >46</td>
      <td id="T_02f6d_row2_col10" class="data row2 col10" >826</td>
    </tr>
    <tr>
      <td id="T_02f6d_row3_col0" class="data row3 col0" >RandomForest</td>
      <td id="T_02f6d_row3_col1" class="data row3 col1" >0.998</td>
      <td id="T_02f6d_row3_col2" class="data row3 col2" >0.666</td>
      <td id="T_02f6d_row3_col3" class="data row3 col3" >0.799</td>
      <td id="T_02f6d_row3_col4" class="data row3 col4" >0.972</td>
      <td id="T_02f6d_row3_col5" class="data row3 col5" >0.964</td>
      <td id="T_02f6d_row3_col6" class="data row3 col6" >{'max_depth': None, 'min_samples_split': 10, 'n_estimators': 300}</td>
      <td id="T_02f6d_row3_col7" class="data row3 col7" >27443</td>
      <td id="T_02f6d_row3_col8" class="data row3 col8" >1699</td>
      <td id="T_02f6d_row3_col9" class="data row3 col9" >3</td>
      <td id="T_02f6d_row3_col10" class="data row3 col10" >851</td>
    </tr>
    <tr>
      <td id="T_02f6d_row4_col0" class="data row4 col0" >XGBoost</td>
      <td id="T_02f6d_row4_col1" class="data row4 col1" >0.985</td>
      <td id="T_02f6d_row4_col2" class="data row4 col2" >0.677</td>
      <td id="T_02f6d_row4_col3" class="data row4 col3" >0.803</td>
      <td id="T_02f6d_row4_col4" class="data row4 col4" >0.972</td>
      <td id="T_02f6d_row4_col5" class="data row4 col5" >0.978</td>
      <td id="T_02f6d_row4_col6" class="data row4 col6" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
      <td id="T_02f6d_row4_col7" class="data row4 col7" >27420</td>
      <td id="T_02f6d_row4_col8" class="data row4 col8" >1727</td>
      <td id="T_02f6d_row4_col9" class="data row4 col9" >26</td>
      <td id="T_02f6d_row4_col10" class="data row4 col10" >823</td>
    </tr>
    <tr>
      <td id="T_02f6d_row5_col0" class="data row5 col0" >SVM</td>
      <td id="T_02f6d_row5_col1" class="data row5 col1" >0.922</td>
      <td id="T_02f6d_row5_col2" class="data row5 col2" >0.597</td>
      <td id="T_02f6d_row5_col3" class="data row5 col3" >0.725</td>
      <td id="T_02f6d_row5_col4" class="data row5 col4" >0.961</td>
      <td id="T_02f6d_row5_col5" class="data row5 col5" >0.959</td>
      <td id="T_02f6d_row5_col6" class="data row5 col6" >{'C': 10, 'gamma': 'scale', 'kernel': 'linear'}</td>
      <td id="T_02f6d_row5_col7" class="data row5 col7" >27318</td>
      <td id="T_02f6d_row5_col8" class="data row5 col8" >1522</td>
      <td id="T_02f6d_row5_col9" class="data row5 col9" >128</td>
      <td id="T_02f6d_row5_col10" class="data row5 col10" >1028</td>
    </tr>
    <tr>
      <td id="T_02f6d_row6_col0" class="data row6 col0" >MLP</td>
      <td id="T_02f6d_row6_col1" class="data row6 col1" >0.930</td>
      <td id="T_02f6d_row6_col2" class="data row6 col2" >0.687</td>
      <td id="T_02f6d_row6_col3" class="data row6 col3" >0.790</td>
      <td id="T_02f6d_row6_col4" class="data row6 col4" >0.969</td>
      <td id="T_02f6d_row6_col5" class="data row6 col5" >0.972</td>
      <td id="T_02f6d_row6_col6" class="data row6 col6" >{'activation': 'relu', 'alpha': 0.01, 'hidden_layer_sizes': (50,), 'solver': 'adam'}</td>
      <td id="T_02f6d_row6_col7" class="data row6 col7" >27314</td>
      <td id="T_02f6d_row6_col8" class="data row6 col8" >1752</td>
      <td id="T_02f6d_row6_col9" class="data row6 col9" >132</td>
      <td id="T_02f6d_row6_col10" class="data row6 col10" >798</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">35</span> <span class="o">+</span> <span class="s2">&quot;TABLA COMPARATIVA DE RESULTADOS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">best_overall_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>====================================================================================================
                                   TABLA COMPARATIVA DE RESULTADOS
====================================================================================================
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
</style>
<table id="T_f6a23">
  <thead>
    <tr>
      <th id="T_f6a23_level0_col0" class="col_heading level0 col0" >Modelo</th>
      <th id="T_f6a23_level0_col1" class="col_heading level0 col1" >Métrica</th>
      <th id="T_f6a23_level0_col2" class="col_heading level0 col2" >Valor</th>
      <th id="T_f6a23_level0_col3" class="col_heading level0 col3" >Parámetros</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_f6a23_row0_col0" class="data row0 col0" >XGBoost</td>
      <td id="T_f6a23_row0_col1" class="data row0 col1" >Accuracy</td>
      <td id="T_f6a23_row0_col2" class="data row0 col2" >0.971696</td>
      <td id="T_f6a23_row0_col3" class="data row0 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_f6a23_row1_col0" class="data row1 col0" >XGBoost</td>
      <td id="T_f6a23_row1_col1" class="data row1 col1" >F1-Score</td>
      <td id="T_f6a23_row1_col2" class="data row1 col2" >0.802696</td>
      <td id="T_f6a23_row1_col3" class="data row1 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_f6a23_row2_col0" class="data row2 col0" >RandomForest</td>
      <td id="T_f6a23_row2_col1" class="data row2 col1" >Precision</td>
      <td id="T_f6a23_row2_col2" class="data row2 col2" >0.998237</td>
      <td id="T_f6a23_row2_col3" class="data row2 col3" >{'max_depth': None, 'min_samples_split': 10, 'n_estimators': 300}</td>
    </tr>
    <tr>
      <td id="T_f6a23_row3_col0" class="data row3 col0" >XGBoost</td>
      <td id="T_f6a23_row3_col1" class="data row3 col1" >ROC-AUC</td>
      <td id="T_f6a23_row3_col2" class="data row3 col2" >0.978170</td>
      <td id="T_f6a23_row3_col3" class="data row3 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_f6a23_row4_col0" class="data row4 col0" >MLP</td>
      <td id="T_f6a23_row4_col1" class="data row4 col1" >Recall</td>
      <td id="T_f6a23_row4_col2" class="data row4 col2" >0.687059</td>
      <td id="T_f6a23_row4_col3" class="data row4 col3" >{'activation': 'relu', 'alpha': 0.01, 'hidden_layer_sizes': (50,), 'solver': 'adam'}</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Entreaniemto de modelo con algoritmo de Regresión Logística y evaluación con thresholds entre 0.30 y 0.48</span>

<span class="c1"># Definición de umbrales para la evaluación.</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.30</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span><span class="mf">0.02</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="n">results_lr_df</span><span class="p">,</span> <span class="n">best_configs_lr</span> <span class="o">=</span> <span class="n">train_LogisticRegression</span><span class="p">(</span>
    <span class="n">X_train</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span>
    <span class="n">X_test</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span>
    <span class="n">y_train</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
    <span class="n">y_test</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="n">thresholds</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">cv_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">101</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_lr_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_75335">
  <thead>
    <tr>
      <th id="T_75335_level0_col0" class="col_heading level0 col0" >Threshold</th>
      <th id="T_75335_level0_col1" class="col_heading level0 col1" >Precision</th>
      <th id="T_75335_level0_col2" class="col_heading level0 col2" >Recall</th>
      <th id="T_75335_level0_col3" class="col_heading level0 col3" >F1-Score</th>
      <th id="T_75335_level0_col4" class="col_heading level0 col4" >Accuracy</th>
      <th id="T_75335_level0_col5" class="col_heading level0 col5" >ROC-AUC</th>
      <th id="T_75335_level0_col6" class="col_heading level0 col6" >Best Params</th>
      <th id="T_75335_level0_col7" class="col_heading level0 col7" >TN</th>
      <th id="T_75335_level0_col8" class="col_heading level0 col8" >TP</th>
      <th id="T_75335_level0_col9" class="col_heading level0 col9" >FP</th>
      <th id="T_75335_level0_col10" class="col_heading level0 col10" >FN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_75335_row0_col0" class="data row0 col0" >0.300000</td>
      <td id="T_75335_row0_col1" class="data row0 col1" >0.714</td>
      <td id="T_75335_row0_col2" class="data row0 col2" >0.709</td>
      <td id="T_75335_row0_col3" class="data row0 col3" >0.712</td>
      <td id="T_75335_row0_col4" class="data row0 col4" >0.951</td>
      <td id="T_75335_row0_col5" class="data row0 col5" >0.961</td>
      <td id="T_75335_row0_col6" class="data row0 col6" >C: 0.1</td>
      <td id="T_75335_row0_col7" class="data row0 col7" >26723</td>
      <td id="T_75335_row0_col8" class="data row0 col8" >1808</td>
      <td id="T_75335_row0_col9" class="data row0 col9" >723</td>
      <td id="T_75335_row0_col10" class="data row0 col10" >742</td>
    </tr>
    <tr>
      <td id="T_75335_row1_col0" class="data row1 col0" >0.320000</td>
      <td id="T_75335_row1_col1" class="data row1 col1" >0.734</td>
      <td id="T_75335_row1_col2" class="data row1 col2" >0.696</td>
      <td id="T_75335_row1_col3" class="data row1 col3" >0.714</td>
      <td id="T_75335_row1_col4" class="data row1 col4" >0.953</td>
      <td id="T_75335_row1_col5" class="data row1 col5" >0.961</td>
      <td id="T_75335_row1_col6" class="data row1 col6" >C: 0.1</td>
      <td id="T_75335_row1_col7" class="data row1 col7" >26802</td>
      <td id="T_75335_row1_col8" class="data row1 col8" >1774</td>
      <td id="T_75335_row1_col9" class="data row1 col9" >644</td>
      <td id="T_75335_row1_col10" class="data row1 col10" >776</td>
    </tr>
    <tr>
      <td id="T_75335_row2_col0" class="data row2 col0" >0.340000</td>
      <td id="T_75335_row2_col1" class="data row2 col1" >0.751</td>
      <td id="T_75335_row2_col2" class="data row2 col2" >0.685</td>
      <td id="T_75335_row2_col3" class="data row2 col3" >0.717</td>
      <td id="T_75335_row2_col4" class="data row2 col4" >0.954</td>
      <td id="T_75335_row2_col5" class="data row2 col5" >0.961</td>
      <td id="T_75335_row2_col6" class="data row2 col6" >C: 0.1</td>
      <td id="T_75335_row2_col7" class="data row2 col7" >26868</td>
      <td id="T_75335_row2_col8" class="data row2 col8" >1747</td>
      <td id="T_75335_row2_col9" class="data row2 col9" >578</td>
      <td id="T_75335_row2_col10" class="data row2 col10" >803</td>
    </tr>
    <tr>
      <td id="T_75335_row3_col0" class="data row3 col0" >0.360000</td>
      <td id="T_75335_row3_col1" class="data row3 col1" >0.768</td>
      <td id="T_75335_row3_col2" class="data row3 col2" >0.678</td>
      <td id="T_75335_row3_col3" class="data row3 col3" >0.720</td>
      <td id="T_75335_row3_col4" class="data row3 col4" >0.955</td>
      <td id="T_75335_row3_col5" class="data row3 col5" >0.961</td>
      <td id="T_75335_row3_col6" class="data row3 col6" >C: 0.1</td>
      <td id="T_75335_row3_col7" class="data row3 col7" >26924</td>
      <td id="T_75335_row3_col8" class="data row3 col8" >1728</td>
      <td id="T_75335_row3_col9" class="data row3 col9" >522</td>
      <td id="T_75335_row3_col10" class="data row3 col10" >822</td>
    </tr>
    <tr>
      <td id="T_75335_row4_col0" class="data row4 col0" >0.380000</td>
      <td id="T_75335_row4_col1" class="data row4 col1" >0.784</td>
      <td id="T_75335_row4_col2" class="data row4 col2" >0.668</td>
      <td id="T_75335_row4_col3" class="data row4 col3" >0.721</td>
      <td id="T_75335_row4_col4" class="data row4 col4" >0.956</td>
      <td id="T_75335_row4_col5" class="data row4 col5" >0.961</td>
      <td id="T_75335_row4_col6" class="data row4 col6" >C: 0.1</td>
      <td id="T_75335_row4_col7" class="data row4 col7" >26976</td>
      <td id="T_75335_row4_col8" class="data row4 col8" >1704</td>
      <td id="T_75335_row4_col9" class="data row4 col9" >470</td>
      <td id="T_75335_row4_col10" class="data row4 col10" >846</td>
    </tr>
    <tr>
      <td id="T_75335_row5_col0" class="data row5 col0" >0.400000</td>
      <td id="T_75335_row5_col1" class="data row5 col1" >0.804</td>
      <td id="T_75335_row5_col2" class="data row5 col2" >0.663</td>
      <td id="T_75335_row5_col3" class="data row5 col3" >0.727</td>
      <td id="T_75335_row5_col4" class="data row5 col4" >0.958</td>
      <td id="T_75335_row5_col5" class="data row5 col5" >0.961</td>
      <td id="T_75335_row5_col6" class="data row5 col6" >C: 0.1</td>
      <td id="T_75335_row5_col7" class="data row5 col7" >27035</td>
      <td id="T_75335_row5_col8" class="data row5 col8" >1690</td>
      <td id="T_75335_row5_col9" class="data row5 col9" >411</td>
      <td id="T_75335_row5_col10" class="data row5 col10" >860</td>
    </tr>
    <tr>
      <td id="T_75335_row6_col0" class="data row6 col0" >0.420000</td>
      <td id="T_75335_row6_col1" class="data row6 col1" >0.820</td>
      <td id="T_75335_row6_col2" class="data row6 col2" >0.656</td>
      <td id="T_75335_row6_col3" class="data row6 col3" >0.729</td>
      <td id="T_75335_row6_col4" class="data row6 col4" >0.959</td>
      <td id="T_75335_row6_col5" class="data row6 col5" >0.961</td>
      <td id="T_75335_row6_col6" class="data row6 col6" >C: 0.1</td>
      <td id="T_75335_row6_col7" class="data row6 col7" >27079</td>
      <td id="T_75335_row6_col8" class="data row6 col8" >1673</td>
      <td id="T_75335_row6_col9" class="data row6 col9" >367</td>
      <td id="T_75335_row6_col10" class="data row6 col10" >877</td>
    </tr>
    <tr>
      <td id="T_75335_row7_col0" class="data row7 col0" >0.440000</td>
      <td id="T_75335_row7_col1" class="data row7 col1" >0.836</td>
      <td id="T_75335_row7_col2" class="data row7 col2" >0.649</td>
      <td id="T_75335_row7_col3" class="data row7 col3" >0.731</td>
      <td id="T_75335_row7_col4" class="data row7 col4" >0.959</td>
      <td id="T_75335_row7_col5" class="data row7 col5" >0.961</td>
      <td id="T_75335_row7_col6" class="data row7 col6" >C: 0.1</td>
      <td id="T_75335_row7_col7" class="data row7 col7" >27122</td>
      <td id="T_75335_row7_col8" class="data row7 col8" >1654</td>
      <td id="T_75335_row7_col9" class="data row7 col9" >324</td>
      <td id="T_75335_row7_col10" class="data row7 col10" >896</td>
    </tr>
    <tr>
      <td id="T_75335_row8_col0" class="data row8 col0" >0.460000</td>
      <td id="T_75335_row8_col1" class="data row8 col1" >0.851</td>
      <td id="T_75335_row8_col2" class="data row8 col2" >0.639</td>
      <td id="T_75335_row8_col3" class="data row8 col3" >0.730</td>
      <td id="T_75335_row8_col4" class="data row8 col4" >0.960</td>
      <td id="T_75335_row8_col5" class="data row8 col5" >0.961</td>
      <td id="T_75335_row8_col6" class="data row8 col6" >C: 0.1</td>
      <td id="T_75335_row8_col7" class="data row8 col7" >27160</td>
      <td id="T_75335_row8_col8" class="data row8 col8" >1630</td>
      <td id="T_75335_row8_col9" class="data row8 col9" >286</td>
      <td id="T_75335_row8_col10" class="data row8 col10" >920</td>
    </tr>
    <tr>
      <td id="T_75335_row9_col0" class="data row9 col0" >0.480000</td>
      <td id="T_75335_row9_col1" class="data row9 col1" >0.862</td>
      <td id="T_75335_row9_col2" class="data row9 col2" >0.633</td>
      <td id="T_75335_row9_col3" class="data row9 col3" >0.730</td>
      <td id="T_75335_row9_col4" class="data row9 col4" >0.960</td>
      <td id="T_75335_row9_col5" class="data row9 col5" >0.961</td>
      <td id="T_75335_row9_col6" class="data row9 col6" >C: 0.1</td>
      <td id="T_75335_row9_col7" class="data row9 col7" >27188</td>
      <td id="T_75335_row9_col8" class="data row9 col8" >1614</td>
      <td id="T_75335_row9_col9" class="data row9 col9" >258</td>
      <td id="T_75335_row9_col10" class="data row9 col10" >936</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_configs_lr</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_1fd6b">
  <thead>
    <tr>
      <th id="T_1fd6b_level0_col0" class="col_heading level0 col0" >Métrica</th>
      <th id="T_1fd6b_level0_col1" class="col_heading level0 col1" >Mejor Threshold</th>
      <th id="T_1fd6b_level0_col2" class="col_heading level0 col2" >Valor</th>
      <th id="T_1fd6b_level0_col3" class="col_heading level0 col3" >Parámetros</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_1fd6b_row0_col0" class="data row0 col0" >Precision</td>
      <td id="T_1fd6b_row0_col1" class="data row0 col1" >0.480000</td>
      <td id="T_1fd6b_row0_col2" class="data row0 col2" >0.862179</td>
      <td id="T_1fd6b_row0_col3" class="data row0 col3" >C: 0.1</td>
    </tr>
    <tr>
      <td id="T_1fd6b_row1_col0" class="data row1 col0" >Recall</td>
      <td id="T_1fd6b_row1_col1" class="data row1 col1" >0.300000</td>
      <td id="T_1fd6b_row1_col2" class="data row1 col2" >0.709020</td>
      <td id="T_1fd6b_row1_col3" class="data row1 col3" >C: 0.1</td>
    </tr>
    <tr>
      <td id="T_1fd6b_row2_col0" class="data row2 col0" >F1-Score</td>
      <td id="T_1fd6b_row2_col1" class="data row2 col1" >0.440000</td>
      <td id="T_1fd6b_row2_col2" class="data row2 col2" >0.730565</td>
      <td id="T_1fd6b_row2_col3" class="data row2 col3" >C: 0.1</td>
    </tr>
    <tr>
      <td id="T_1fd6b_row3_col0" class="data row3 col0" >Accuracy</td>
      <td id="T_1fd6b_row3_col1" class="data row3 col1" >0.480000</td>
      <td id="T_1fd6b_row3_col2" class="data row3 col2" >0.960195</td>
      <td id="T_1fd6b_row3_col3" class="data row3 col3" >C: 0.1</td>
    </tr>
    <tr>
      <td id="T_1fd6b_row4_col0" class="data row4 col0" >ROC-AUC</td>
      <td id="T_1fd6b_row4_col1" class="data row4 col1" >0.300000</td>
      <td id="T_1fd6b_row4_col2" class="data row4 col2" >0.960556</td>
      <td id="T_1fd6b_row4_col3" class="data row4 col3" >C: 0.1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_balanced_df</span><span class="p">,</span> <span class="n">best_config_balanced_df</span><span class="p">,</span> <span class="n">roc_curves_balanced</span> <span class="o">=</span> <span class="n">benchmark_models</span><span class="o">.</span><span class="n">run_benchmark</span><span class="p">(</span>
    <span class="n">common_params</span><span class="o">=</span><span class="n">common_params</span><span class="p">,</span>
    <span class="n">preprocessor</span><span class="o">=</span><span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">balance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>   <span class="c1"># Sin aplicar remuestreo balanceado mediante SMOTE ni SMOTE-Tomek</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;smote_tomek&quot;</span><span class="p">,</span>
    <span class="n">sampling_strategy</span><span class="o">=</span><span class="mi">15000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando modelo: KNN
Fitting 5 folds for each of 14 candidates, totalling 70 fits
Entrenamiento completado. Tiempo entrenamiento KNN: 459.6583 segundos

Entrenando modelo: LogisticRegression
Fitting 5 folds for each of 20 candidates, totalling 100 fits
Entrenamiento completado. Tiempo entrenamiento LogisticRegression: 139.6412 segundos

Entrenando modelo: DecisionTree
Fitting 5 folds for each of 45 candidates, totalling 225 fits
Entrenamiento completado. Tiempo entrenamiento DecisionTree: 12.7919 segundos

Entrenando modelo: RandomForest
Fitting 5 folds for each of 45 candidates, totalling 225 fits
Entrenamiento completado. Tiempo entrenamiento RandomForest: 378.7573 segundos

Entrenando modelo: XGBoost
Fitting 5 folds for each of 72 candidates, totalling 360 fits
Entrenamiento completado. Tiempo entrenamiento XGBoost: 74.3946 segundos

Entrenando modelo: SVM
Fitting 5 folds for each of 12 candidates, totalling 60 fits
Entrenamiento completado. Tiempo entrenamiento SVM: 4379.8907 segundos

Entrenando modelo: MLP
Fitting 5 folds for each of 36 candidates, totalling 180 fits
Entrenamiento completado. Tiempo entrenamiento MLP: 1763.0466 segundos
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Construcción del modelo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tamaños:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train:</span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># print(f&quot;Calibración:{X_cal.shape}&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test:</span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Definir vocabularios para categóricas</span>
<span class="n">cat_vocab_sizes</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_cols</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vocabulario variables categóricas = </span><span class="si">{</span><span class="n">cat_vocab_sizes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tamaños:
Train:(69990, 15)
Test:(29996, 15)

Vocabulario variables categóricas = {&#39;year&#39;: 7, &#39;gender&#39;: 3, &#39;location&#39;: 55, &#39;smoking_history&#39;: 6}
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Preprocesamiento de los datos para el entrenamiento:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --------------------- PREPROCESAMIENTO PARA TopKTabularMoE -------------------------------</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="c1"># por si en el futuro aparecen categorías no vistas en el entrenamiento.</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 2. Ajustar el codificador SOLO con los datos de entrenamiento (X_train)</span>
<span class="c1">#    y transformar X_train.</span>
<span class="n">X_train</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">])</span>

<span class="c1">#  Transformar X_test usando el encoder YA AJUSTADO. Es crucial no volver a hacer &#39;fit&#39;.</span>
<span class="n">X_test</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">])</span> <span class="c1"># &lt;-- Paso crucial para X_test</span>


<span class="c1"># Crear el DataFrame de entrenamiento completo</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_df</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span>

<span class="c1"># DataFrame para la función evaluate</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">test_df</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span> <span class="c1"># &lt;-- Re-unimos X_test con y_test</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preprocesamiento terminado.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Preprocesamiento terminado.
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Especificación del modelo SparseTabularMoE:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src</span><span class="w"> </span><span class="kn">import</span> <span class="n">spartan</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>

<span class="c1"># --- 2. Configuración de Estrategia Distribuida ---</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">distribute</span><span class="o">.</span><span class="n">MirroredStrategy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estrategia distribuida activada. Dispositivos: </span><span class="si">{</span><span class="n">strategy</span><span class="o">.</span><span class="n">num_replicas_in_sync</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">d_model</span> <span class="o">=</span> <span class="mi">128</span>

<span class="c1"># Parámetros para construir la arquitectura del modelo</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cont_cols&#39;</span><span class="p">:</span> <span class="n">numerical_cols</span><span class="p">,</span>
    <span class="s1">&#39;bin_cols&#39;</span><span class="p">:</span> <span class="n">binary_cols</span><span class="p">,</span>
    <span class="s1">&#39;cat_cols&#39;</span><span class="p">:</span> <span class="n">categorical_cols</span><span class="p">,</span>
    <span class="s1">&#39;cat_vocab_sizes&#39;</span><span class="p">:</span> <span class="n">cat_vocab_sizes</span><span class="p">,</span>
    <span class="s1">&#39;d_model&#39;</span><span class="p">:</span> <span class="n">d_model</span><span class="p">,</span>
    <span class="s1">&#39;num_heads&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;d_ff&#39;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">d_model</span><span class="p">,</span>
    <span class="s1">&#39;num_experts&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;num_layers&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;dropout&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="c1"># Parámetros para el proceso de entrenamiento</span>
<span class="n">training_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">3e-4</span><span class="p">,</span>
    <span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="c1"># Puedes reducir las épocas para una CV más rápida</span>
    <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">256</span> <span class="o">*</span> <span class="n">strategy</span><span class="o">.</span><span class="n">num_replicas_in_sync</span><span class="p">,</span>
    <span class="s1">&#39;target_col&#39;</span><span class="p">:</span> <span class="n">TARGET_COL</span><span class="p">,</span>
    <span class="s1">&#39;col_groups&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># Agrupamos las listas de columnas</span>
        <span class="s1">&#39;cont_cols&#39;</span><span class="p">:</span> <span class="n">numerical_cols</span><span class="p">,</span>
        <span class="s1">&#39;bin_cols&#39;</span><span class="p">:</span> <span class="n">binary_cols</span><span class="p">,</span>
        <span class="s1">&#39;cat_cols&#39;</span><span class="p">:</span> <span class="n">categorical_cols</span><span class="p">,</span>
        <span class="s1">&#39;target_col&#39;</span><span class="p">:</span> <span class="n">TARGET_COL</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:tensorflow:Using MirroredStrategy with devices (&#39;/job:localhost/replica:0/task:0/device:GPU:0&#39;,)
Estrategia distribuida activada. Dispositivos: 1
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Entrenamiento del modelo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src</span><span class="w"> </span><span class="kn">import</span> <span class="n">spartan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.spartan</span><span class="w"> </span><span class="kn">import</span> <span class="n">cross_validation</span> <span class="k">as</span> <span class="n">cv</span>
<span class="c1"># --- 4. Ejecutar la Validación Cruzada ---</span>
<span class="c1"># Una sola llamada a la función orquesta todo el proceso.</span>
<span class="n">best_model</span><span class="p">,</span> <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">run_cross_validation</span><span class="p">(</span>
    <span class="n">df_full_train</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="c1"># Usando el DataFrame de entrenamiento completo</span>
    <span class="n">target_col</span><span class="o">=</span><span class="n">TARGET_COL</span><span class="p">,</span>
    <span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">,</span>
    <span class="n">model_build_params</span><span class="o">=</span><span class="n">model_params</span><span class="p">,</span>
    <span class="n">training_params</span><span class="o">=</span><span class="n">training_params</span><span class="p">,</span>
    <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># Número de folds</span>
    <span class="n">apply_smote</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># No se aplica muestreo balanceado</span>
    <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Análisis detallado por fold:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iniciando validación cruzada con 5 folds...
--------------------------------------------------
--- FOLD 1/5 ---
--------------------------------------------------
Fold 1: No se aplicará remuestreo.
Fold 1: Construyendo y compilando un nuevo modelo...
Convirtiendo DataFrames a tensores para el entrenamiento...
Creando datasets de TensorFlow...
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
INFO:tensorflow:Reduce to /job:localhost/replica:0/task:0/device:CPU:0 then broadcast to (&#39;/job:localhost/replica:0/task:0/device:CPU:0&#39;,).
Epoch 1/30

Epoch 1: f1_score improved from -inf to 0.01005, saving model to model.weights.best.weights.h5
219/219 - 33s - 151ms/step - accuracy: 0.9120 - auc: 0.6093 - f1_score: 0.0100 - loss: 0.0744 - precision: 0.1152 - recall: 0.0053 - val_accuracy: 0.9150 - val_auc: 0.7225 - val_f1_score: 0.0000e+00 - val_loss: 0.0254 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 2/30

Epoch 2: f1_score did not improve from 0.01005
219/219 - 24s - 110ms/step - accuracy: 0.9150 - auc: 0.6914 - f1_score: 0.0034 - loss: 0.0662 - precision: 0.5333 - recall: 0.0017 - val_accuracy: 0.9150 - val_auc: 0.7489 - val_f1_score: 0.0000e+00 - val_loss: 0.0252 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 3/30

Epoch 3: f1_score improved from 0.01005 to 0.02278, saving model to model.weights.best.weights.h5
219/219 - 25s - 112ms/step - accuracy: 0.9157 - auc: 0.7518 - f1_score: 0.0228 - loss: 0.0646 - precision: 0.7971 - recall: 0.0116 - val_accuracy: 0.9170 - val_auc: 0.8136 - val_f1_score: 0.0475 - val_loss: 0.0229 - val_precision: 0.9667 - val_recall: 0.0244 - learning_rate: 3.0000e-04
Epoch 4/30

Epoch 4: f1_score improved from 0.02278 to 0.10824, saving model to model.weights.best.weights.h5
219/219 - 24s - 111ms/step - accuracy: 0.9194 - auc: 0.8233 - f1_score: 0.1082 - loss: 0.0621 - precision: 0.9043 - recall: 0.0576 - val_accuracy: 0.9162 - val_auc: 0.8643 - val_f1_score: 0.0282 - val_loss: 0.0211 - val_precision: 1.0000 - val_recall: 0.0143 - learning_rate: 3.0000e-04
Epoch 5/30

Epoch 5: f1_score improved from 0.10824 to 0.27313, saving model to model.weights.best.weights.h5
219/219 - 25s - 113ms/step - accuracy: 0.9275 - auc: 0.8690 - f1_score: 0.2731 - loss: 0.0596 - precision: 0.9226 - recall: 0.1603 - val_accuracy: 0.9204 - val_auc: 0.8890 - val_f1_score: 0.1201 - val_loss: 0.0210 - val_precision: 1.0000 - val_recall: 0.0639 - learning_rate: 3.0000e-04
Epoch 6/30

Epoch 6: f1_score improved from 0.27313 to 0.39120, saving model to model.weights.best.weights.h5
219/219 - 25s - 116ms/step - accuracy: 0.9347 - auc: 0.8808 - f1_score: 0.3912 - loss: 0.0585 - precision: 0.9452 - recall: 0.2466 - val_accuracy: 0.9358 - val_auc: 0.9063 - val_f1_score: 0.3930 - val_loss: 0.0182 - val_precision: 1.0000 - val_recall: 0.2445 - learning_rate: 3.0000e-04
Epoch 7/30

Epoch 7: f1_score improved from 0.39120 to 0.44229, saving model to model.weights.best.weights.h5
219/219 - 24s - 111ms/step - accuracy: 0.9384 - auc: 0.8968 - f1_score: 0.4423 - loss: 0.0573 - precision: 0.9593 - recall: 0.2874 - val_accuracy: 0.9347 - val_auc: 0.9086 - val_f1_score: 0.3765 - val_loss: 0.0170 - val_precision: 1.0000 - val_recall: 0.2319 - learning_rate: 3.0000e-04
Epoch 8/30

Epoch 8: f1_score improved from 0.44229 to 0.45271, saving model to model.weights.best.weights.h5
219/219 - 27s - 121ms/step - accuracy: 0.9390 - auc: 0.9054 - f1_score: 0.4527 - loss: 0.0569 - precision: 0.9553 - recall: 0.2966 - val_accuracy: 0.9355 - val_auc: 0.9215 - val_f1_score: 0.3886 - val_loss: 0.0173 - val_precision: 1.0000 - val_recall: 0.2412 - learning_rate: 3.0000e-04
Epoch 9/30

Epoch 9: f1_score improved from 0.45271 to 0.46382, saving model to model.weights.best.weights.h5
219/219 - 36s - 165ms/step - accuracy: 0.9399 - auc: 0.9112 - f1_score: 0.4638 - loss: 0.0564 - precision: 0.9610 - recall: 0.3057 - val_accuracy: 0.9381 - val_auc: 0.9230 - val_f1_score: 0.4270 - val_loss: 0.0165 - val_precision: 1.0000 - val_recall: 0.2714 - learning_rate: 3.0000e-04
Epoch 10/30

Epoch 10: f1_score improved from 0.46382 to 0.48308, saving model to model.weights.best.weights.h5
219/219 - 41s - 188ms/step - accuracy: 0.9413 - auc: 0.9175 - f1_score: 0.4831 - loss: 0.0559 - precision: 0.9624 - recall: 0.3225 - val_accuracy: 0.9364 - val_auc: 0.9315 - val_f1_score: 0.4027 - val_loss: 0.0164 - val_precision: 1.0000 - val_recall: 0.2521 - learning_rate: 3.0000e-04
Epoch 11/30

Epoch 11: f1_score improved from 0.48308 to 0.48471, saving model to model.weights.best.weights.h5
219/219 - 33s - 151ms/step - accuracy: 0.9416 - auc: 0.9248 - f1_score: 0.4847 - loss: 0.0554 - precision: 0.9716 - recall: 0.3229 - val_accuracy: 0.9365 - val_auc: 0.9367 - val_f1_score: 0.4038 - val_loss: 0.0160 - val_precision: 1.0000 - val_recall: 0.2529 - learning_rate: 3.0000e-04
Epoch 12/30

Epoch 12: f1_score improved from 0.48471 to 0.48964, saving model to model.weights.best.weights.h5
219/219 - 30s - 139ms/step - accuracy: 0.9419 - auc: 0.9289 - f1_score: 0.4896 - loss: 0.0552 - precision: 0.9677 - recall: 0.3277 - val_accuracy: 0.9370 - val_auc: 0.9420 - val_f1_score: 0.4112 - val_loss: 0.0164 - val_precision: 1.0000 - val_recall: 0.2588 - learning_rate: 3.0000e-04
Epoch 13/30

Epoch 13: f1_score improved from 0.48964 to 0.50573, saving model to model.weights.best.weights.h5
219/219 - 31s - 140ms/step - accuracy: 0.9430 - auc: 0.9336 - f1_score: 0.5057 - loss: 0.0547 - precision: 0.9617 - recall: 0.3431 - val_accuracy: 0.9381 - val_auc: 0.9487 - val_f1_score: 0.4280 - val_loss: 0.0140 - val_precision: 1.0000 - val_recall: 0.2723 - learning_rate: 3.0000e-04
Epoch 14/30

Epoch 14: f1_score improved from 0.50573 to 0.51379, saving model to model.weights.best.weights.h5
219/219 - 32s - 148ms/step - accuracy: 0.9437 - auc: 0.9387 - f1_score: 0.5138 - loss: 0.0543 - precision: 0.9641 - recall: 0.3502 - val_accuracy: 0.9442 - val_auc: 0.9547 - val_f1_score: 0.5122 - val_loss: 0.0128 - val_precision: 0.9976 - val_recall: 0.3445 - learning_rate: 3.0000e-04
Epoch 15/30

Epoch 15: f1_score improved from 0.51379 to 0.53503, saving model to model.weights.best.weights.h5
219/219 - 34s - 156ms/step - accuracy: 0.9452 - auc: 0.9424 - f1_score: 0.5350 - loss: 0.0539 - precision: 0.9618 - recall: 0.3706 - val_accuracy: 0.9363 - val_auc: 0.9517 - val_f1_score: 0.4005 - val_loss: 0.0151 - val_precision: 1.0000 - val_recall: 0.2504 - learning_rate: 3.0000e-04
Epoch 16/30

Epoch 16: f1_score improved from 0.53503 to 0.54924, saving model to model.weights.best.weights.h5
219/219 - 34s - 157ms/step - accuracy: 0.9462 - auc: 0.9457 - f1_score: 0.5492 - loss: 0.0537 - precision: 0.9547 - recall: 0.3855 - val_accuracy: 0.9398 - val_auc: 0.9577 - val_f1_score: 0.4525 - val_loss: 0.0142 - val_precision: 1.0000 - val_recall: 0.2924 - learning_rate: 3.0000e-04
Epoch 17/30

Epoch 17: f1_score improved from 0.54924 to 0.58387, saving model to model.weights.best.weights.h5
219/219 - 34s - 155ms/step - accuracy: 0.9490 - auc: 0.9511 - f1_score: 0.5839 - loss: 0.0530 - precision: 0.9511 - recall: 0.4212 - val_accuracy: 0.9351 - val_auc: 0.9485 - val_f1_score: 0.3832 - val_loss: 0.0181 - val_precision: 1.0000 - val_recall: 0.2370 - learning_rate: 3.0000e-04
Epoch 18/30

Epoch 18: f1_score improved from 0.58387 to 0.59919, saving model to model.weights.best.weights.h5
219/219 - 34s - 155ms/step - accuracy: 0.9504 - auc: 0.9525 - f1_score: 0.5992 - loss: 0.0527 - precision: 0.9580 - recall: 0.4359 - val_accuracy: 0.9496 - val_auc: 0.9654 - val_f1_score: 0.5791 - val_loss: 0.0119 - val_precision: 1.0000 - val_recall: 0.4076 - learning_rate: 3.0000e-04
Epoch 19/30

Epoch 19: f1_score improved from 0.59919 to 0.61468, saving model to model.weights.best.weights.h5
219/219 - 34s - 157ms/step - accuracy: 0.9519 - auc: 0.9546 - f1_score: 0.6147 - loss: 0.0525 - precision: 0.9637 - recall: 0.4513 - val_accuracy: 0.9383 - val_auc: 0.9626 - val_f1_score: 0.4311 - val_loss: 0.0163 - val_precision: 1.0000 - val_recall: 0.2748 - learning_rate: 3.0000e-04
Epoch 20/30

Epoch 20: f1_score did not improve from 0.61468
219/219 - 35s - 161ms/step - accuracy: 0.9510 - auc: 0.9549 - f1_score: 0.6084 - loss: 0.0525 - precision: 0.9509 - recall: 0.4473 - val_accuracy: 0.9432 - val_auc: 0.9653 - val_f1_score: 0.4991 - val_loss: 0.0144 - val_precision: 0.9975 - val_recall: 0.3328 - learning_rate: 3.0000e-04
Epoch 21/30

Epoch 21: f1_score improved from 0.61468 to 0.62884, saving model to model.weights.best.weights.h5
219/219 - 35s - 162ms/step - accuracy: 0.9532 - auc: 0.9558 - f1_score: 0.6288 - loss: 0.0522 - precision: 0.9632 - recall: 0.4668 - val_accuracy: 0.9497 - val_auc: 0.9654 - val_f1_score: 0.5800 - val_loss: 0.0124 - val_precision: 1.0000 - val_recall: 0.4084 - learning_rate: 3.0000e-04
Epoch 22/30

Epoch 22: f1_score improved from 0.62884 to 0.63446, saving model to model.weights.best.weights.h5
219/219 - 35s - 162ms/step - accuracy: 0.9535 - auc: 0.9563 - f1_score: 0.6345 - loss: 0.0522 - precision: 0.9568 - recall: 0.4746 - val_accuracy: 0.9420 - val_auc: 0.9548 - val_f1_score: 0.4821 - val_loss: 0.0168 - val_precision: 1.0000 - val_recall: 0.3176 - learning_rate: 3.0000e-04
Epoch 23/30

Epoch 23: f1_score improved from 0.63446 to 0.63602, saving model to model.weights.best.weights.h5
219/219 - 35s - 162ms/step - accuracy: 0.9538 - auc: 0.9595 - f1_score: 0.6360 - loss: 0.0519 - precision: 0.9613 - recall: 0.4752 - val_accuracy: 0.9498 - val_auc: 0.9670 - val_f1_score: 0.5808 - val_loss: 0.0116 - val_precision: 1.0000 - val_recall: 0.4092 - learning_rate: 3.0000e-04
Epoch 24/30

Epoch 24: f1_score improved from 0.63602 to 0.65236, saving model to model.weights.best.weights.h5
219/219 - 35s - 162ms/step - accuracy: 0.9554 - auc: 0.9595 - f1_score: 0.6524 - loss: 0.0517 - precision: 0.9686 - recall: 0.4918 - val_accuracy: 0.9519 - val_auc: 0.9638 - val_f1_score: 0.6049 - val_loss: 0.0117 - val_precision: 1.0000 - val_recall: 0.4336 - learning_rate: 3.0000e-04
Epoch 25/30

Epoch 25: f1_score did not improve from 0.65236
219/219 - 36s - 163ms/step - accuracy: 0.9552 - auc: 0.9593 - f1_score: 0.6508 - loss: 0.0516 - precision: 0.9641 - recall: 0.4912 - val_accuracy: 0.9493 - val_auc: 0.9584 - val_f1_score: 0.5757 - val_loss: 0.0157 - val_precision: 1.0000 - val_recall: 0.4042 - learning_rate: 3.0000e-04
Epoch 26/30

Epoch 26: f1_score did not improve from 0.65236
219/219 - 36s - 164ms/step - accuracy: 0.9550 - auc: 0.9592 - f1_score: 0.6478 - loss: 0.0518 - precision: 0.9670 - recall: 0.4870 - val_accuracy: 0.9488 - val_auc: 0.9637 - val_f1_score: 0.5707 - val_loss: 0.0127 - val_precision: 0.9958 - val_recall: 0.4000 - learning_rate: 3.0000e-04
Epoch 27/30

Epoch 27: f1_score improved from 0.65236 to 0.65362, saving model to model.weights.best.weights.h5
219/219 - 36s - 165ms/step - accuracy: 0.9554 - auc: 0.9593 - f1_score: 0.6536 - loss: 0.0517 - precision: 0.9628 - recall: 0.4947 - val_accuracy: 0.9500 - val_auc: 0.9664 - val_f1_score: 0.5833 - val_loss: 0.0116 - val_precision: 1.0000 - val_recall: 0.4118 - learning_rate: 3.0000e-04
Epoch 28/30

Epoch 28: f1_score improved from 0.65362 to 0.65610, saving model to model.weights.best.weights.h5
219/219 - 36s - 164ms/step - accuracy: 0.9558 - auc: 0.9604 - f1_score: 0.6561 - loss: 0.0515 - precision: 0.9704 - recall: 0.4956 - val_accuracy: 0.9536 - val_auc: 0.9652 - val_f1_score: 0.6251 - val_loss: 0.0125 - val_precision: 1.0000 - val_recall: 0.4546 - learning_rate: 3.0000e-04
Epoch 29/30

Epoch 29: f1_score did not improve from 0.65610
219/219 - 37s - 167ms/step - accuracy: 0.9554 - auc: 0.9597 - f1_score: 0.6524 - loss: 0.0516 - precision: 0.9686 - recall: 0.4918 - val_accuracy: 0.9518 - val_auc: 0.9664 - val_f1_score: 0.6041 - val_loss: 0.0127 - val_precision: 1.0000 - val_recall: 0.4328 - learning_rate: 3.0000e-04
Epoch 30/30

Epoch 30: f1_score improved from 0.65610 to 0.66574, saving model to model.weights.best.weights.h5
219/219 - 38s - 172ms/step - accuracy: 0.9568 - auc: 0.9603 - f1_score: 0.6657 - loss: 0.0515 - precision: 0.9741 - recall: 0.5057 - val_accuracy: 0.9584 - val_auc: 0.9692 - val_f1_score: 0.6767 - val_loss: 0.0104 - val_precision: 0.9984 - val_recall: 0.5118 - learning_rate: 3.0000e-04
Restoring model weights from the end of the best epoch: 30.
Fold 1: Evaluando el modelo...
--------------------------------------------------
--- FOLD 2/5 ---
--------------------------------------------------
Fold 2: No se aplicará remuestreo.
Fold 2: Construyendo y compilando un nuevo modelo...
Convirtiendo DataFrames a tensores para el entrenamiento...
Creando datasets de TensorFlow...
Epoch 1/30

Epoch 1: f1_score improved from -inf to 0.01242, saving model to model.weights.best.weights.h5
219/219 - 44s - 202ms/step - accuracy: 0.9120 - auc: 0.6047 - f1_score: 0.0124 - loss: 0.0751 - precision: 0.1348 - recall: 0.0065 - val_accuracy: 0.9150 - val_auc: 0.7050 - val_f1_score: 0.0000e+00 - val_loss: 0.0258 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 2/30

Epoch 2: f1_score did not improve from 0.01242
219/219 - 36s - 167ms/step - accuracy: 0.9150 - auc: 0.6757 - f1_score: 8.3981e-04 - loss: 0.0667 - precision: 0.6667 - recall: 4.2017e-04 - val_accuracy: 0.9150 - val_auc: 0.7272 - val_f1_score: 0.0000e+00 - val_loss: 0.0252 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 3/30

Epoch 3: f1_score did not improve from 0.01242
219/219 - 37s - 171ms/step - accuracy: 0.9151 - auc: 0.7163 - f1_score: 0.0083 - loss: 0.0655 - precision: 0.6061 - recall: 0.0042 - val_accuracy: 0.9159 - val_auc: 0.7805 - val_f1_score: 0.0360 - val_loss: 0.0237 - val_precision: 0.7097 - val_recall: 0.0185 - learning_rate: 3.0000e-04
Epoch 4/30

Epoch 4: f1_score improved from 0.01242 to 0.01905, saving model to model.weights.best.weights.h5
219/219 - 38s - 173ms/step - accuracy: 0.9154 - auc: 0.7689 - f1_score: 0.0191 - loss: 0.0643 - precision: 0.6667 - recall: 0.0097 - val_accuracy: 0.9161 - val_auc: 0.8248 - val_f1_score: 0.0249 - val_loss: 0.0225 - val_precision: 1.0000 - val_recall: 0.0126 - learning_rate: 3.0000e-04
Epoch 5/30

Epoch 5: f1_score improved from 0.01905 to 0.03822, saving model to model.weights.best.weights.h5
219/219 - 37s - 171ms/step - accuracy: 0.9164 - auc: 0.8128 - f1_score: 0.0382 - loss: 0.0628 - precision: 0.8692 - recall: 0.0195 - val_accuracy: 0.9226 - val_auc: 0.8786 - val_f1_score: 0.1636 - val_loss: 0.0195 - val_precision: 1.0000 - val_recall: 0.0891 - learning_rate: 3.0000e-04
Epoch 6/30

Epoch 6: f1_score improved from 0.03822 to 0.26403, saving model to model.weights.best.weights.h5
219/219 - 37s - 170ms/step - accuracy: 0.9269 - auc: 0.8634 - f1_score: 0.2640 - loss: 0.0601 - precision: 0.9175 - recall: 0.1542 - val_accuracy: 0.9372 - val_auc: 0.9076 - val_f1_score: 0.4152 - val_loss: 0.0169 - val_precision: 0.9968 - val_recall: 0.2622 - learning_rate: 3.0000e-04
Epoch 7/30

Epoch 7: f1_score improved from 0.26403 to 0.38127, saving model to model.weights.best.weights.h5
219/219 - 37s - 170ms/step - accuracy: 0.9342 - auc: 0.8907 - f1_score: 0.3813 - loss: 0.0580 - precision: 0.9475 - recall: 0.2387 - val_accuracy: 0.9349 - val_auc: 0.9171 - val_f1_score: 0.3799 - val_loss: 0.0166 - val_precision: 1.0000 - val_recall: 0.2345 - learning_rate: 3.0000e-04
Epoch 8/30

Epoch 8: f1_score improved from 0.38127 to 0.41162, saving model to model.weights.best.weights.h5
219/219 - 38s - 172ms/step - accuracy: 0.9363 - auc: 0.9025 - f1_score: 0.4116 - loss: 0.0573 - precision: 0.9600 - recall: 0.2620 - val_accuracy: 0.9380 - val_auc: 0.9284 - val_f1_score: 0.4259 - val_loss: 0.0153 - val_precision: 1.0000 - val_recall: 0.2706 - learning_rate: 3.0000e-04
Epoch 9/30

Epoch 9: f1_score improved from 0.41162 to 0.42948, saving model to model.weights.best.weights.h5
219/219 - 37s - 171ms/step - accuracy: 0.9375 - auc: 0.9086 - f1_score: 0.4295 - loss: 0.0568 - precision: 0.9592 - recall: 0.2767 - val_accuracy: 0.9430 - val_auc: 0.9345 - val_f1_score: 0.4956 - val_loss: 0.0148 - val_precision: 1.0000 - val_recall: 0.3294 - learning_rate: 3.0000e-04
Epoch 10/30

Epoch 10: f1_score improved from 0.42948 to 0.45459, saving model to model.weights.best.weights.h5
219/219 - 37s - 170ms/step - accuracy: 0.9394 - auc: 0.9156 - f1_score: 0.4546 - loss: 0.0562 - precision: 0.9678 - recall: 0.2971 - val_accuracy: 0.9411 - val_auc: 0.9387 - val_f1_score: 0.4704 - val_loss: 0.0153 - val_precision: 1.0000 - val_recall: 0.3076 - learning_rate: 3.0000e-04
Epoch 11/30

Epoch 11: f1_score did not improve from 0.45459
219/219 - 37s - 170ms/step - accuracy: 0.9389 - auc: 0.9188 - f1_score: 0.4510 - loss: 0.0561 - precision: 0.9551 - recall: 0.2952 - val_accuracy: 0.9382 - val_auc: 0.9401 - val_f1_score: 0.4290 - val_loss: 0.0147 - val_precision: 1.0000 - val_recall: 0.2731 - learning_rate: 3.0000e-04
Epoch 12/30

Epoch 12: f1_score improved from 0.45459 to 0.47532, saving model to model.weights.best.weights.h5
219/219 - 38s - 171ms/step - accuracy: 0.9408 - auc: 0.9265 - f1_score: 0.4753 - loss: 0.0555 - precision: 0.9628 - recall: 0.3155 - val_accuracy: 0.9406 - val_auc: 0.9470 - val_f1_score: 0.4635 - val_loss: 0.0142 - val_precision: 1.0000 - val_recall: 0.3017 - learning_rate: 3.0000e-04
Epoch 13/30

Epoch 13: f1_score improved from 0.47532 to 0.48510, saving model to model.weights.best.weights.h5
219/219 - 38s - 172ms/step - accuracy: 0.9414 - auc: 0.9313 - f1_score: 0.4851 - loss: 0.0550 - precision: 0.9579 - recall: 0.3248 - val_accuracy: 0.9357 - val_auc: 0.9470 - val_f1_score: 0.3935 - val_loss: 0.0147 - val_precision: 0.9932 - val_recall: 0.2454 - learning_rate: 3.0000e-04
Epoch 14/30

Epoch 14: f1_score improved from 0.48510 to 0.49556, saving model to model.weights.best.weights.h5
219/219 - 37s - 171ms/step - accuracy: 0.9422 - auc: 0.9365 - f1_score: 0.4956 - loss: 0.0546 - precision: 0.9579 - recall: 0.3342 - val_accuracy: 0.9428 - val_auc: 0.9543 - val_f1_score: 0.4940 - val_loss: 0.0130 - val_precision: 0.9949 - val_recall: 0.3286 - learning_rate: 3.0000e-04
Epoch 15/30

Epoch 15: f1_score improved from 0.49556 to 0.52357, saving model to model.weights.best.weights.h5
219/219 - 38s - 176ms/step - accuracy: 0.9442 - auc: 0.9410 - f1_score: 0.5236 - loss: 0.0541 - precision: 0.9560 - recall: 0.3605 - val_accuracy: 0.9423 - val_auc: 0.9546 - val_f1_score: 0.4883 - val_loss: 0.0134 - val_precision: 0.9948 - val_recall: 0.3235 - learning_rate: 3.0000e-04
Epoch 16/30

Epoch 16: f1_score improved from 0.52357 to 0.53870, saving model to model.weights.best.weights.h5
219/219 - 41s - 189ms/step - accuracy: 0.9452 - auc: 0.9447 - f1_score: 0.5387 - loss: 0.0539 - precision: 0.9466 - recall: 0.3765 - val_accuracy: 0.9397 - val_auc: 0.9561 - val_f1_score: 0.4519 - val_loss: 0.0153 - val_precision: 0.9943 - val_recall: 0.2924 - learning_rate: 3.0000e-04
Epoch 17/30

Epoch 17: f1_score improved from 0.53870 to 0.57407, saving model to model.weights.best.weights.h5
219/219 - 39s - 177ms/step - accuracy: 0.9481 - auc: 0.9498 - f1_score: 0.5741 - loss: 0.0532 - precision: 0.9509 - recall: 0.4111 - val_accuracy: 0.9512 - val_auc: 0.9633 - val_f1_score: 0.5985 - val_loss: 0.0116 - val_precision: 0.9961 - val_recall: 0.4277 - learning_rate: 3.0000e-04
Epoch 18/30

Epoch 18: f1_score improved from 0.57407 to 0.58736, saving model to model.weights.best.weights.h5
219/219 - 36s - 166ms/step - accuracy: 0.9493 - auc: 0.9496 - f1_score: 0.5874 - loss: 0.0533 - precision: 0.9515 - recall: 0.4248 - val_accuracy: 0.9447 - val_auc: 0.9615 - val_f1_score: 0.5181 - val_loss: 0.0128 - val_precision: 1.0000 - val_recall: 0.3496 - learning_rate: 3.0000e-04
Epoch 19/30

Epoch 19: f1_score improved from 0.58736 to 0.59506, saving model to model.weights.best.weights.h5
219/219 - 38s - 175ms/step - accuracy: 0.9499 - auc: 0.9507 - f1_score: 0.5951 - loss: 0.0530 - precision: 0.9511 - recall: 0.4330 - val_accuracy: 0.9441 - val_auc: 0.9634 - val_f1_score: 0.5103 - val_loss: 0.0140 - val_precision: 0.9976 - val_recall: 0.3429 - learning_rate: 3.0000e-04
Epoch 20/30

Epoch 20: f1_score improved from 0.59506 to 0.61851, saving model to model.weights.best.weights.h5
219/219 - 38s - 174ms/step - accuracy: 0.9521 - auc: 0.9531 - f1_score: 0.6185 - loss: 0.0527 - precision: 0.9569 - recall: 0.4569 - val_accuracy: 0.9435 - val_auc: 0.9603 - val_f1_score: 0.5022 - val_loss: 0.0141 - val_precision: 1.0000 - val_recall: 0.3353 - learning_rate: 3.0000e-04
Epoch 21/30

Epoch 21: f1_score improved from 0.61851 to 0.62953, saving model to model.weights.best.weights.h5
219/219 - 38s - 175ms/step - accuracy: 0.9531 - auc: 0.9558 - f1_score: 0.6295 - loss: 0.0523 - precision: 0.9575 - recall: 0.4689 - val_accuracy: 0.9496 - val_auc: 0.9639 - val_f1_score: 0.5796 - val_loss: 0.0130 - val_precision: 0.9979 - val_recall: 0.4084 - learning_rate: 3.0000e-04
Epoch 22/30

Epoch 22: f1_score improved from 0.62953 to 0.63965, saving model to model.weights.best.weights.h5
219/219 - 39s - 178ms/step - accuracy: 0.9541 - auc: 0.9566 - f1_score: 0.6397 - loss: 0.0522 - precision: 0.9616 - recall: 0.4792 - val_accuracy: 0.9527 - val_auc: 0.9645 - val_f1_score: 0.6151 - val_loss: 0.0115 - val_precision: 0.9981 - val_recall: 0.4445 - learning_rate: 3.0000e-04
Epoch 23/30

Epoch 23: f1_score did not improve from 0.63965
219/219 - 39s - 176ms/step - accuracy: 0.9539 - auc: 0.9570 - f1_score: 0.6374 - loss: 0.0522 - precision: 0.9598 - recall: 0.4771 - val_accuracy: 0.9459 - val_auc: 0.9628 - val_f1_score: 0.5342 - val_loss: 0.0142 - val_precision: 0.9977 - val_recall: 0.3647 - learning_rate: 3.0000e-04
Epoch 24/30

Epoch 24: f1_score improved from 0.63965 to 0.64571, saving model to model.weights.best.weights.h5
219/219 - 38s - 173ms/step - accuracy: 0.9547 - auc: 0.9582 - f1_score: 0.6457 - loss: 0.0521 - precision: 0.9637 - recall: 0.4855 - val_accuracy: 0.9560 - val_auc: 0.9662 - val_f1_score: 0.6508 - val_loss: 0.0110 - val_precision: 1.0000 - val_recall: 0.4824 - learning_rate: 3.0000e-04
Epoch 25/30

Epoch 25: f1_score did not improve from 0.64571
219/219 - 39s - 176ms/step - accuracy: 0.9541 - auc: 0.9571 - f1_score: 0.6391 - loss: 0.0521 - precision: 0.9652 - recall: 0.4777 - val_accuracy: 0.9511 - val_auc: 0.9640 - val_f1_score: 0.5963 - val_loss: 0.0127 - val_precision: 0.9980 - val_recall: 0.4252 - learning_rate: 3.0000e-04
Epoch 26/30

Epoch 26: f1_score improved from 0.64571 to 0.65292, saving model to model.weights.best.weights.h5
219/219 - 37s - 169ms/step - accuracy: 0.9555 - auc: 0.9585 - f1_score: 0.6529 - loss: 0.0518 - precision: 0.9694 - recall: 0.4922 - val_accuracy: 0.9490 - val_auc: 0.9642 - val_f1_score: 0.5714 - val_loss: 0.0140 - val_precision: 1.0000 - val_recall: 0.4000 - learning_rate: 3.0000e-04
Epoch 27/30

Epoch 27: f1_score improved from 0.65292 to 0.65750, saving model to model.weights.best.weights.h5
219/219 - 39s - 179ms/step - accuracy: 0.9560 - auc: 0.9598 - f1_score: 0.6575 - loss: 0.0517 - precision: 0.9709 - recall: 0.4971 - val_accuracy: 0.9534 - val_auc: 0.9656 - val_f1_score: 0.6223 - val_loss: 0.0135 - val_precision: 0.9981 - val_recall: 0.4521 - learning_rate: 3.0000e-04
Epoch 28/30

Epoch 28: f1_score did not improve from 0.65750
219/219 - 38s - 174ms/step - accuracy: 0.9556 - auc: 0.9598 - f1_score: 0.6538 - loss: 0.0518 - precision: 0.9690 - recall: 0.4933 - val_accuracy: 0.9466 - val_auc: 0.9654 - val_f1_score: 0.5417 - val_loss: 0.0152 - val_precision: 1.0000 - val_recall: 0.3714 - learning_rate: 3.0000e-04
Epoch 29/30

Epoch 29: f1_score did not improve from 0.65750
219/219 - 42s - 190ms/step - accuracy: 0.9553 - auc: 0.9594 - f1_score: 0.6516 - loss: 0.0519 - precision: 0.9661 - recall: 0.4916 - val_accuracy: 0.9534 - val_auc: 0.9653 - val_f1_score: 0.6223 - val_loss: 0.0128 - val_precision: 0.9981 - val_recall: 0.4521 - learning_rate: 3.0000e-04
Epoch 30/30

Epoch 30: f1_score improved from 0.65750 to 0.67016, saving model to model.weights.best.weights.h5
219/219 - 41s - 189ms/step - accuracy: 0.9572 - auc: 0.9616 - f1_score: 0.6702 - loss: 0.0514 - precision: 0.9736 - recall: 0.5109 - val_accuracy: 0.9493 - val_auc: 0.9662 - val_f1_score: 0.5757 - val_loss: 0.0144 - val_precision: 1.0000 - val_recall: 0.4042 - learning_rate: 3.0000e-04
Restoring model weights from the end of the best epoch: 30.
Fold 2: Evaluando el modelo...
--------------------------------------------------
--- FOLD 3/5 ---
--------------------------------------------------
Fold 3: No se aplicará remuestreo.
Fold 3: Construyendo y compilando un nuevo modelo...
Convirtiendo DataFrames a tensores para el entrenamiento...
Creando datasets de TensorFlow...
Epoch 1/30

Epoch 1: f1_score improved from -inf to 0.01075, saving model to model.weights.best.weights.h5
219/219 - 49s - 223ms/step - accuracy: 0.9113 - auc: 0.6141 - f1_score: 0.0108 - loss: 0.0791 - precision: 0.1031 - recall: 0.0057 - val_accuracy: 0.9150 - val_auc: 0.7038 - val_f1_score: 0.0000e+00 - val_loss: 0.0257 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 2/30

Epoch 2: f1_score did not improve from 0.01075
219/219 - 43s - 195ms/step - accuracy: 0.9150 - auc: 0.6891 - f1_score: 0.0013 - loss: 0.0664 - precision: 0.4286 - recall: 6.3025e-04 - val_accuracy: 0.9150 - val_auc: 0.7262 - val_f1_score: 0.0000e+00 - val_loss: 0.0251 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 3/30

Epoch 3: f1_score did not improve from 0.01075
219/219 - 41s - 185ms/step - accuracy: 0.9151 - auc: 0.7203 - f1_score: 0.0059 - loss: 0.0655 - precision: 0.7000 - recall: 0.0029 - val_accuracy: 0.9158 - val_auc: 0.7662 - val_f1_score: 0.0216 - val_loss: 0.0240 - val_precision: 0.8667 - val_recall: 0.0109 - learning_rate: 3.0000e-04
Epoch 4/30

Epoch 4: f1_score improved from 0.01075 to 0.01866, saving model to model.weights.best.weights.h5
219/219 - 40s - 181ms/step - accuracy: 0.9155 - auc: 0.7677 - f1_score: 0.0187 - loss: 0.0642 - precision: 0.7258 - recall: 0.0095 - val_accuracy: 0.9183 - val_auc: 0.8070 - val_f1_score: 0.0877 - val_loss: 0.0234 - val_precision: 0.8594 - val_recall: 0.0462 - learning_rate: 3.0000e-04
Epoch 5/30

Epoch 5: f1_score improved from 0.01866 to 0.05373, saving model to model.weights.best.weights.h5
219/219 - 43s - 196ms/step - accuracy: 0.9170 - auc: 0.7890 - f1_score: 0.0537 - loss: 0.0635 - precision: 0.8627 - recall: 0.0277 - val_accuracy: 0.9202 - val_auc: 0.8200 - val_f1_score: 0.1225 - val_loss: 0.0219 - val_precision: 0.9398 - val_recall: 0.0655 - learning_rate: 3.0000e-04
Epoch 6/30

Epoch 6: f1_score improved from 0.05373 to 0.11915, saving model to model.weights.best.weights.h5
219/219 - 39s - 177ms/step - accuracy: 0.9197 - auc: 0.8098 - f1_score: 0.1191 - loss: 0.0626 - precision: 0.8863 - recall: 0.0639 - val_accuracy: 0.9238 - val_auc: 0.8416 - val_f1_score: 0.1936 - val_loss: 0.0212 - val_precision: 0.9697 - val_recall: 0.1076 - learning_rate: 3.0000e-04
Epoch 7/30

Epoch 7: f1_score improved from 0.11915 to 0.23755, saving model to model.weights.best.weights.h5
219/219 - 41s - 186ms/step - accuracy: 0.9256 - auc: 0.8528 - f1_score: 0.2376 - loss: 0.0606 - precision: 0.9219 - recall: 0.1363 - val_accuracy: 0.9304 - val_auc: 0.9094 - val_f1_score: 0.3073 - val_loss: 0.0179 - val_precision: 1.0000 - val_recall: 0.1815 - learning_rate: 3.0000e-04
Epoch 8/30

Epoch 8: f1_score improved from 0.23755 to 0.36110, saving model to model.weights.best.weights.h5
219/219 - 39s - 178ms/step - accuracy: 0.9329 - auc: 0.8825 - f1_score: 0.3611 - loss: 0.0588 - precision: 0.9465 - recall: 0.2231 - val_accuracy: 0.9309 - val_auc: 0.9200 - val_f1_score: 0.3156 - val_loss: 0.0181 - val_precision: 1.0000 - val_recall: 0.1874 - learning_rate: 3.0000e-04
Epoch 9/30

Epoch 9: f1_score improved from 0.36110 to 0.40179, saving model to model.weights.best.weights.h5
219/219 - 38s - 173ms/step - accuracy: 0.9357 - auc: 0.9003 - f1_score: 0.4018 - loss: 0.0575 - precision: 0.9610 - recall: 0.2540 - val_accuracy: 0.9353 - val_auc: 0.9301 - val_f1_score: 0.3853 - val_loss: 0.0157 - val_precision: 1.0000 - val_recall: 0.2387 - learning_rate: 3.0000e-04
Epoch 10/30

Epoch 10: f1_score improved from 0.40179 to 0.44574, saving model to model.weights.best.weights.h5
219/219 - 39s - 180ms/step - accuracy: 0.9387 - auc: 0.9116 - f1_score: 0.4457 - loss: 0.0566 - precision: 0.9637 - recall: 0.2899 - val_accuracy: 0.9312 - val_auc: 0.9279 - val_f1_score: 0.3204 - val_loss: 0.0162 - val_precision: 1.0000 - val_recall: 0.1908 - learning_rate: 3.0000e-04
Epoch 11/30

Epoch 11: f1_score improved from 0.44574 to 0.44985, saving model to model.weights.best.weights.h5
219/219 - 41s - 189ms/step - accuracy: 0.9390 - auc: 0.9166 - f1_score: 0.4498 - loss: 0.0562 - precision: 0.9628 - recall: 0.2935 - val_accuracy: 0.9386 - val_auc: 0.9400 - val_f1_score: 0.4342 - val_loss: 0.0157 - val_precision: 1.0000 - val_recall: 0.2773 - learning_rate: 3.0000e-04
Epoch 12/30

Epoch 12: f1_score improved from 0.44985 to 0.46277, saving model to model.weights.best.weights.h5
219/219 - 42s - 190ms/step - accuracy: 0.9400 - auc: 0.9223 - f1_score: 0.4628 - loss: 0.0558 - precision: 0.9666 - recall: 0.3042 - val_accuracy: 0.9382 - val_auc: 0.9437 - val_f1_score: 0.4290 - val_loss: 0.0150 - val_precision: 1.0000 - val_recall: 0.2731 - learning_rate: 3.0000e-04
Epoch 13/30

Epoch 13: f1_score improved from 0.46277 to 0.47709, saving model to model.weights.best.weights.h5
219/219 - 40s - 182ms/step - accuracy: 0.9409 - auc: 0.9296 - f1_score: 0.4771 - loss: 0.0553 - precision: 0.9618 - recall: 0.3172 - val_accuracy: 0.9363 - val_auc: 0.9497 - val_f1_score: 0.4005 - val_loss: 0.0164 - val_precision: 1.0000 - val_recall: 0.2504 - learning_rate: 3.0000e-04
Epoch 14/30

Epoch 14: f1_score improved from 0.47709 to 0.49332, saving model to model.weights.best.weights.h5
219/219 - 37s - 169ms/step - accuracy: 0.9418 - auc: 0.9372 - f1_score: 0.4933 - loss: 0.0545 - precision: 0.9480 - recall: 0.3334 - val_accuracy: 0.9376 - val_auc: 0.9547 - val_f1_score: 0.4197 - val_loss: 0.0138 - val_precision: 1.0000 - val_recall: 0.2655 - learning_rate: 3.0000e-04
Epoch 15/30

Epoch 15: f1_score improved from 0.49332 to 0.51904, saving model to model.weights.best.weights.h5
219/219 - 38s - 173ms/step - accuracy: 0.9438 - auc: 0.9412 - f1_score: 0.5190 - loss: 0.0543 - precision: 0.9539 - recall: 0.3565 - val_accuracy: 0.9464 - val_auc: 0.9600 - val_f1_score: 0.5416 - val_loss: 0.0125 - val_precision: 0.9933 - val_recall: 0.3723 - learning_rate: 3.0000e-04
Epoch 16/30

Epoch 16: f1_score improved from 0.51904 to 0.55267, saving model to model.weights.best.weights.h5
219/219 - 40s - 183ms/step - accuracy: 0.9465 - auc: 0.9474 - f1_score: 0.5527 - loss: 0.0536 - precision: 0.9537 - recall: 0.3891 - val_accuracy: 0.9436 - val_auc: 0.9662 - val_f1_score: 0.5041 - val_loss: 0.0129 - val_precision: 1.0000 - val_recall: 0.3370 - learning_rate: 3.0000e-04
Epoch 17/30

Epoch 17: f1_score improved from 0.55267 to 0.57566, saving model to model.weights.best.weights.h5
219/219 - 38s - 173ms/step - accuracy: 0.9483 - auc: 0.9493 - f1_score: 0.5757 - loss: 0.0532 - precision: 0.9529 - recall: 0.4124 - val_accuracy: 0.9443 - val_auc: 0.9689 - val_f1_score: 0.5134 - val_loss: 0.0130 - val_precision: 1.0000 - val_recall: 0.3454 - learning_rate: 3.0000e-04
Epoch 18/30

Epoch 18: f1_score improved from 0.57566 to 0.61073, saving model to model.weights.best.weights.h5
219/219 - 38s - 175ms/step - accuracy: 0.9515 - auc: 0.9510 - f1_score: 0.6107 - loss: 0.0529 - precision: 0.9625 - recall: 0.4473 - val_accuracy: 0.9446 - val_auc: 0.9654 - val_f1_score: 0.5171 - val_loss: 0.0145 - val_precision: 1.0000 - val_recall: 0.3487 - learning_rate: 3.0000e-04
Epoch 19/30

Epoch 19: f1_score did not improve from 0.61073
219/219 - 37s - 171ms/step - accuracy: 0.9506 - auc: 0.9544 - f1_score: 0.6018 - loss: 0.0528 - precision: 0.9544 - recall: 0.4395 - val_accuracy: 0.9327 - val_auc: 0.9675 - val_f1_score: 0.3449 - val_loss: 0.0179 - val_precision: 1.0000 - val_recall: 0.2084 - learning_rate: 3.0000e-04
Epoch 20/30

Epoch 20: f1_score improved from 0.61073 to 0.61771, saving model to model.weights.best.weights.h5
219/219 - 38s - 172ms/step - accuracy: 0.9520 - auc: 0.9549 - f1_score: 0.6177 - loss: 0.0525 - precision: 0.9576 - recall: 0.4559 - val_accuracy: 0.9481 - val_auc: 0.9691 - val_f1_score: 0.5611 - val_loss: 0.0121 - val_precision: 1.0000 - val_recall: 0.3899 - learning_rate: 3.0000e-04
Epoch 21/30

Epoch 21: f1_score improved from 0.61771 to 0.62689, saving model to model.weights.best.weights.h5
219/219 - 38s - 172ms/step - accuracy: 0.9529 - auc: 0.9562 - f1_score: 0.6269 - loss: 0.0522 - precision: 0.9585 - recall: 0.4658 - val_accuracy: 0.9509 - val_auc: 0.9664 - val_f1_score: 0.5942 - val_loss: 0.0122 - val_precision: 1.0000 - val_recall: 0.4227 - learning_rate: 3.0000e-04
Epoch 22/30

Epoch 22: f1_score improved from 0.62689 to 0.62740, saving model to model.weights.best.weights.h5
219/219 - 39s - 178ms/step - accuracy: 0.9531 - auc: 0.9556 - f1_score: 0.6274 - loss: 0.0524 - precision: 0.9672 - recall: 0.4643 - val_accuracy: 0.9486 - val_auc: 0.9674 - val_f1_score: 0.5671 - val_loss: 0.0128 - val_precision: 1.0000 - val_recall: 0.3958 - learning_rate: 3.0000e-04
Epoch 23/30

Epoch 23: f1_score improved from 0.62740 to 0.63208, saving model to model.weights.best.weights.h5
219/219 - 40s - 181ms/step - accuracy: 0.9535 - auc: 0.9585 - f1_score: 0.6321 - loss: 0.0520 - precision: 0.9659 - recall: 0.4697 - val_accuracy: 0.9507 - val_auc: 0.9693 - val_f1_score: 0.5917 - val_loss: 0.0124 - val_precision: 1.0000 - val_recall: 0.4202 - learning_rate: 3.0000e-04
Epoch 24/30

Epoch 24: f1_score improved from 0.63208 to 0.65208, saving model to model.weights.best.weights.h5
219/219 - 41s - 188ms/step - accuracy: 0.9554 - auc: 0.9587 - f1_score: 0.6521 - loss: 0.0518 - precision: 0.9689 - recall: 0.4914 - val_accuracy: 0.9416 - val_auc: 0.9639 - val_f1_score: 0.4763 - val_loss: 0.0149 - val_precision: 1.0000 - val_recall: 0.3126 - learning_rate: 3.0000e-04
Epoch 25/30

Epoch 25: f1_score improved from 0.65208 to 0.65262, saving model to model.weights.best.weights.h5
219/219 - 39s - 179ms/step - accuracy: 0.9555 - auc: 0.9583 - f1_score: 0.6526 - loss: 0.0518 - precision: 0.9721 - recall: 0.4912 - val_accuracy: 0.9510 - val_auc: 0.9680 - val_f1_score: 0.5950 - val_loss: 0.0127 - val_precision: 1.0000 - val_recall: 0.4235 - learning_rate: 3.0000e-04
Epoch 26/30

Epoch 26: f1_score did not improve from 0.65262
219/219 - 41s - 188ms/step - accuracy: 0.9550 - auc: 0.9598 - f1_score: 0.6472 - loss: 0.0517 - precision: 0.9694 - recall: 0.4857 - val_accuracy: 0.9535 - val_auc: 0.9694 - val_f1_score: 0.6235 - val_loss: 0.0114 - val_precision: 1.0000 - val_recall: 0.4529 - learning_rate: 3.0000e-04
Epoch 27/30

Epoch 27: f1_score improved from 0.65262 to 0.66085, saving model to model.weights.best.weights.h5
219/219 - 38s - 175ms/step - accuracy: 0.9563 - auc: 0.9612 - f1_score: 0.6609 - loss: 0.0514 - precision: 0.9695 - recall: 0.5013 - val_accuracy: 0.9552 - val_auc: 0.9681 - val_f1_score: 0.6423 - val_loss: 0.0114 - val_precision: 1.0000 - val_recall: 0.4731 - learning_rate: 3.0000e-04
Epoch 28/30

Epoch 28: f1_score improved from 0.66085 to 0.66611, saving model to model.weights.best.weights.h5
219/219 - 40s - 184ms/step - accuracy: 0.9568 - auc: 0.9618 - f1_score: 0.6661 - loss: 0.0514 - precision: 0.9703 - recall: 0.5071 - val_accuracy: 0.9581 - val_auc: 0.9685 - val_f1_score: 0.6726 - val_loss: 0.0108 - val_precision: 1.0000 - val_recall: 0.5067 - learning_rate: 3.0000e-04
Epoch 29/30

Epoch 29: f1_score did not improve from 0.66611
219/219 - 39s - 178ms/step - accuracy: 0.9553 - auc: 0.9605 - f1_score: 0.6510 - loss: 0.0516 - precision: 0.9685 - recall: 0.4903 - val_accuracy: 0.9512 - val_auc: 0.9703 - val_f1_score: 0.5975 - val_loss: 0.0127 - val_precision: 1.0000 - val_recall: 0.4261 - learning_rate: 3.0000e-04
Epoch 30/30

Epoch 30: f1_score improved from 0.66611 to 0.66833, saving model to model.weights.best.weights.h5
219/219 - 42s - 192ms/step - accuracy: 0.9571 - auc: 0.9619 - f1_score: 0.6683 - loss: 0.0513 - precision: 0.9766 - recall: 0.5080 - val_accuracy: 0.9571 - val_auc: 0.9701 - val_f1_score: 0.6622 - val_loss: 0.0106 - val_precision: 1.0000 - val_recall: 0.4950 - learning_rate: 3.0000e-04
Restoring model weights from the end of the best epoch: 30.
Fold 3: Evaluando el modelo...
--------------------------------------------------
--- FOLD 4/5 ---
--------------------------------------------------
Fold 4: No se aplicará remuestreo.
Fold 4: Construyendo y compilando un nuevo modelo...
Convirtiendo DataFrames a tensores para el entrenamiento...
Creando datasets de TensorFlow...
Epoch 1/30

Epoch 1: f1_score improved from -inf to 0.01119, saving model to model.weights.best.weights.h5
219/219 - 48s - 217ms/step - accuracy: 0.9116 - auc: 0.6088 - f1_score: 0.0112 - loss: 0.0779 - precision: 0.1143 - recall: 0.0059 - val_accuracy: 0.9151 - val_auc: 0.7243 - val_f1_score: 0.0100 - val_loss: 0.0260 - val_precision: 0.5455 - val_recall: 0.0050 - learning_rate: 3.0000e-04
Epoch 2/30

Epoch 2: f1_score did not improve from 0.01119
219/219 - 38s - 173ms/step - accuracy: 0.9149 - auc: 0.6858 - f1_score: 0.0038 - loss: 0.0664 - precision: 0.4286 - recall: 0.0019 - val_accuracy: 0.9150 - val_auc: 0.7457 - val_f1_score: 0.0000e+00 - val_loss: 0.0248 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 3/30

Epoch 3: f1_score did not improve from 0.01119
219/219 - 39s - 176ms/step - accuracy: 0.9151 - auc: 0.7168 - f1_score: 0.0054 - loss: 0.0655 - precision: 0.6842 - recall: 0.0027 - val_accuracy: 0.9151 - val_auc: 0.7933 - val_f1_score: 0.0017 - val_loss: 0.0238 - val_precision: 1.0000 - val_recall: 8.4034e-04 - learning_rate: 3.0000e-04
Epoch 4/30

Epoch 4: f1_score improved from 0.01119 to 0.02927, saving model to model.weights.best.weights.h5
219/219 - 39s - 180ms/step - accuracy: 0.9159 - auc: 0.7786 - f1_score: 0.0293 - loss: 0.0639 - precision: 0.7717 - recall: 0.0149 - val_accuracy: 0.9183 - val_auc: 0.8333 - val_f1_score: 0.0849 - val_loss: 0.0222 - val_precision: 0.8983 - val_recall: 0.0445 - learning_rate: 3.0000e-04
Epoch 5/30

Epoch 5: f1_score improved from 0.02927 to 0.11940, saving model to model.weights.best.weights.h5
219/219 - 40s - 181ms/step - accuracy: 0.9199 - auc: 0.8335 - f1_score: 0.1194 - loss: 0.0617 - precision: 0.9157 - recall: 0.0639 - val_accuracy: 0.9279 - val_auc: 0.8764 - val_f1_score: 0.2767 - val_loss: 0.0195 - val_precision: 0.9415 - val_recall: 0.1622 - learning_rate: 3.0000e-04
Epoch 6/30

Epoch 6: f1_score improved from 0.11940 to 0.35860, saving model to model.weights.best.weights.h5
219/219 - 40s - 180ms/step - accuracy: 0.9326 - auc: 0.8727 - f1_score: 0.3586 - loss: 0.0591 - precision: 0.9386 - recall: 0.2216 - val_accuracy: 0.9344 - val_auc: 0.9050 - val_f1_score: 0.3721 - val_loss: 0.0171 - val_precision: 1.0000 - val_recall: 0.2286 - learning_rate: 3.0000e-04
Epoch 7/30

Epoch 7: f1_score improved from 0.35860 to 0.43497, saving model to model.weights.best.weights.h5
219/219 - 39s - 180ms/step - accuracy: 0.9378 - auc: 0.8921 - f1_score: 0.4350 - loss: 0.0576 - precision: 0.9538 - recall: 0.2817 - val_accuracy: 0.9397 - val_auc: 0.9180 - val_f1_score: 0.4505 - val_loss: 0.0158 - val_precision: 1.0000 - val_recall: 0.2908 - learning_rate: 3.0000e-04
Epoch 8/30

Epoch 8: f1_score improved from 0.43497 to 0.44251, saving model to model.weights.best.weights.h5
219/219 - 39s - 179ms/step - accuracy: 0.9383 - auc: 0.9040 - f1_score: 0.4425 - loss: 0.0570 - precision: 0.9567 - recall: 0.2878 - val_accuracy: 0.9413 - val_auc: 0.9292 - val_f1_score: 0.4724 - val_loss: 0.0152 - val_precision: 1.0000 - val_recall: 0.3092 - learning_rate: 3.0000e-04
Epoch 9/30

Epoch 9: f1_score improved from 0.44251 to 0.46541, saving model to model.weights.best.weights.h5
219/219 - 39s - 179ms/step - accuracy: 0.9401 - auc: 0.9118 - f1_score: 0.4654 - loss: 0.0564 - precision: 0.9643 - recall: 0.3067 - val_accuracy: 0.9393 - val_auc: 0.9347 - val_f1_score: 0.4444 - val_loss: 0.0154 - val_precision: 1.0000 - val_recall: 0.2857 - learning_rate: 3.0000e-04
Epoch 10/30

Epoch 10: f1_score improved from 0.46541 to 0.47771, saving model to model.weights.best.weights.h5
219/219 - 39s - 180ms/step - accuracy: 0.9410 - auc: 0.9161 - f1_score: 0.4777 - loss: 0.0560 - precision: 0.9649 - recall: 0.3174 - val_accuracy: 0.9386 - val_auc: 0.9367 - val_f1_score: 0.4352 - val_loss: 0.0156 - val_precision: 1.0000 - val_recall: 0.2782 - learning_rate: 3.0000e-04
Epoch 11/30

Epoch 11: f1_score did not improve from 0.47771
219/219 - 39s - 179ms/step - accuracy: 0.9408 - auc: 0.9218 - f1_score: 0.4754 - loss: 0.0556 - precision: 0.9634 - recall: 0.3155 - val_accuracy: 0.9425 - val_auc: 0.9429 - val_f1_score: 0.4895 - val_loss: 0.0139 - val_precision: 0.9974 - val_recall: 0.3244 - learning_rate: 3.0000e-04
Epoch 12/30

Epoch 12: f1_score improved from 0.47771 to 0.48478, saving model to model.weights.best.weights.h5
219/219 - 39s - 179ms/step - accuracy: 0.9413 - auc: 0.9283 - f1_score: 0.4848 - loss: 0.0551 - precision: 0.9572 - recall: 0.3246 - val_accuracy: 0.9396 - val_auc: 0.9496 - val_f1_score: 0.4485 - val_loss: 0.0159 - val_precision: 1.0000 - val_recall: 0.2891 - learning_rate: 3.0000e-04
Epoch 13/30

Epoch 13: f1_score improved from 0.48478 to 0.49220, saving model to model.weights.best.weights.h5
219/219 - 3129s - 14s/step - accuracy: 0.9419 - auc: 0.9280 - f1_score: 0.4922 - loss: 0.0552 - precision: 0.9569 - recall: 0.3313 - val_accuracy: 0.9353 - val_auc: 0.9471 - val_f1_score: 0.3864 - val_loss: 0.0166 - val_precision: 1.0000 - val_recall: 0.2395 - learning_rate: 3.0000e-04
Epoch 14/30

Epoch 14: f1_score improved from 0.49220 to 0.49805, saving model to model.weights.best.weights.h5
219/219 - 2046s - 9s/step - accuracy: 0.9425 - auc: 0.9353 - f1_score: 0.4981 - loss: 0.0546 - precision: 0.9661 - recall: 0.3355 - val_accuracy: 0.9381 - val_auc: 0.9527 - val_f1_score: 0.4280 - val_loss: 0.0140 - val_precision: 1.0000 - val_recall: 0.2723 - learning_rate: 3.0000e-04
Epoch 15/30

Epoch 15: f1_score improved from 0.49805 to 0.52112, saving model to model.weights.best.weights.h5
219/219 - 5158s - 24s/step - accuracy: 0.9439 - auc: 0.9407 - f1_score: 0.5211 - loss: 0.0541 - precision: 0.9500 - recall: 0.3590 - val_accuracy: 0.9416 - val_auc: 0.9588 - val_f1_score: 0.4773 - val_loss: 0.0129 - val_precision: 1.0000 - val_recall: 0.3134 - learning_rate: 3.0000e-04
Epoch 16/30

Epoch 16: f1_score improved from 0.52112 to 0.54638, saving model to model.weights.best.weights.h5
219/219 - 3621s - 17s/step - accuracy: 0.9460 - auc: 0.9450 - f1_score: 0.5464 - loss: 0.0536 - precision: 0.9569 - recall: 0.3824 - val_accuracy: 0.9423 - val_auc: 0.9542 - val_f1_score: 0.4860 - val_loss: 0.0141 - val_precision: 1.0000 - val_recall: 0.3210 - learning_rate: 3.0000e-04
Epoch 17/30

Epoch 17: f1_score improved from 0.54638 to 0.57705, saving model to model.weights.best.weights.h5
219/219 - 3551s - 16s/step - accuracy: 0.9485 - auc: 0.9494 - f1_score: 0.5770 - loss: 0.0532 - precision: 0.9572 - recall: 0.4130 - val_accuracy: 0.9478 - val_auc: 0.9647 - val_f1_score: 0.5576 - val_loss: 0.0117 - val_precision: 1.0000 - val_recall: 0.3866 - learning_rate: 3.0000e-04
Epoch 18/30

Epoch 18: f1_score improved from 0.57705 to 0.58401, saving model to model.weights.best.weights.h5
219/219 - 3662s - 17s/step - accuracy: 0.9491 - auc: 0.9515 - f1_score: 0.5840 - loss: 0.0530 - precision: 0.9552 - recall: 0.4206 - val_accuracy: 0.9393 - val_auc: 0.9642 - val_f1_score: 0.4455 - val_loss: 0.0151 - val_precision: 1.0000 - val_recall: 0.2866 - learning_rate: 3.0000e-04
Epoch 19/30

Epoch 19: f1_score improved from 0.58401 to 0.61153, saving model to model.weights.best.weights.h5
219/219 - 4400s - 20s/step - accuracy: 0.9515 - auc: 0.9529 - f1_score: 0.6115 - loss: 0.0526 - precision: 0.9587 - recall: 0.4489 - val_accuracy: 0.9489 - val_auc: 0.9689 - val_f1_score: 0.5711 - val_loss: 0.0121 - val_precision: 0.9979 - val_recall: 0.4000 - learning_rate: 3.0000e-04
Epoch 20/30

Epoch 20: f1_score improved from 0.61153 to 0.61707, saving model to model.weights.best.weights.h5
219/219 - 3089s - 14s/step - accuracy: 0.9520 - auc: 0.9551 - f1_score: 0.6171 - loss: 0.0524 - precision: 0.9592 - recall: 0.4548 - val_accuracy: 0.9508 - val_auc: 0.9675 - val_f1_score: 0.5925 - val_loss: 0.0111 - val_precision: 1.0000 - val_recall: 0.4210 - learning_rate: 3.0000e-04
Epoch 21/30

Epoch 21: f1_score improved from 0.61707 to 0.63180, saving model to model.weights.best.weights.h5
219/219 - 4231s - 19s/step - accuracy: 0.9534 - auc: 0.9550 - f1_score: 0.6318 - loss: 0.0523 - precision: 0.9602 - recall: 0.4708 - val_accuracy: 0.9519 - val_auc: 0.9640 - val_f1_score: 0.6057 - val_loss: 0.0122 - val_precision: 1.0000 - val_recall: 0.4345 - learning_rate: 3.0000e-04
Epoch 22/30

Epoch 22: f1_score improved from 0.63180 to 0.64193, saving model to model.weights.best.weights.h5
219/219 - 2875s - 13s/step - accuracy: 0.9543 - auc: 0.9558 - f1_score: 0.6419 - loss: 0.0521 - precision: 0.9626 - recall: 0.4815 - val_accuracy: 0.9520 - val_auc: 0.9713 - val_f1_score: 0.6066 - val_loss: 0.0116 - val_precision: 1.0000 - val_recall: 0.4353 - learning_rate: 3.0000e-04
Epoch 23/30

Epoch 23: f1_score did not improve from 0.64193
219/219 - 2913s - 13s/step - accuracy: 0.9539 - auc: 0.9556 - f1_score: 0.6355 - loss: 0.0522 - precision: 0.9670 - recall: 0.4733 - val_accuracy: 0.9531 - val_auc: 0.9706 - val_f1_score: 0.6204 - val_loss: 0.0109 - val_precision: 0.9963 - val_recall: 0.4504 - learning_rate: 3.0000e-04
Epoch 24/30

Epoch 24: f1_score improved from 0.64193 to 0.64241, saving model to model.weights.best.weights.h5
219/219 - 2556s - 12s/step - accuracy: 0.9545 - auc: 0.9563 - f1_score: 0.6424 - loss: 0.0520 - precision: 0.9699 - recall: 0.4803 - val_accuracy: 0.9535 - val_auc: 0.9706 - val_f1_score: 0.6235 - val_loss: 0.0109 - val_precision: 1.0000 - val_recall: 0.4529 - learning_rate: 3.0000e-04
Epoch 25/30

Epoch 25: f1_score improved from 0.64241 to 0.65350, saving model to model.weights.best.weights.h5
219/219 - 2128s - 10s/step - accuracy: 0.9555 - auc: 0.9586 - f1_score: 0.6535 - loss: 0.0516 - precision: 0.9671 - recall: 0.4935 - val_accuracy: 0.9493 - val_auc: 0.9642 - val_f1_score: 0.5749 - val_loss: 0.0135 - val_precision: 1.0000 - val_recall: 0.4034 - learning_rate: 3.0000e-04
Epoch 26/30

Epoch 26: f1_score did not improve from 0.65350
219/219 - 2501s - 11s/step - accuracy: 0.9554 - auc: 0.9587 - f1_score: 0.6521 - loss: 0.0517 - precision: 0.9689 - recall: 0.4914 - val_accuracy: 0.9431 - val_auc: 0.9678 - val_f1_score: 0.4965 - val_loss: 0.0132 - val_precision: 1.0000 - val_recall: 0.3303 - learning_rate: 3.0000e-04
Epoch 27/30

Epoch 27: f1_score improved from 0.65350 to 0.65579, saving model to model.weights.best.weights.h5
219/219 - 34s - 154ms/step - accuracy: 0.9559 - auc: 0.9588 - f1_score: 0.6558 - loss: 0.0516 - precision: 0.9755 - recall: 0.4939 - val_accuracy: 0.9569 - val_auc: 0.9713 - val_f1_score: 0.6603 - val_loss: 0.0104 - val_precision: 0.9983 - val_recall: 0.4933 - learning_rate: 3.0000e-04
Epoch 28/30

Epoch 28: f1_score improved from 0.65579 to 0.66010, saving model to model.weights.best.weights.h5
219/219 - 29s - 132ms/step - accuracy: 0.9562 - auc: 0.9604 - f1_score: 0.6601 - loss: 0.0514 - precision: 0.9710 - recall: 0.5000 - val_accuracy: 0.9529 - val_auc: 0.9700 - val_f1_score: 0.6171 - val_loss: 0.0117 - val_precision: 1.0000 - val_recall: 0.4462 - learning_rate: 3.0000e-04
Epoch 29/30

Epoch 29: f1_score improved from 0.66010 to 0.66455, saving model to model.weights.best.weights.h5
219/219 - 33s - 153ms/step - accuracy: 0.9567 - auc: 0.9609 - f1_score: 0.6645 - loss: 0.0513 - precision: 0.9721 - recall: 0.5048 - val_accuracy: 0.9549 - val_auc: 0.9715 - val_f1_score: 0.6384 - val_loss: 0.0114 - val_precision: 1.0000 - val_recall: 0.4689 - learning_rate: 3.0000e-04
Epoch 30/30

Epoch 30: f1_score improved from 0.66455 to 0.66795, saving model to model.weights.best.weights.h5
219/219 - 31s - 142ms/step - accuracy: 0.9570 - auc: 0.9617 - f1_score: 0.6680 - loss: 0.0513 - precision: 0.9719 - recall: 0.5088 - val_accuracy: 0.9513 - val_auc: 0.9703 - val_f1_score: 0.5984 - val_loss: 0.0120 - val_precision: 1.0000 - val_recall: 0.4269 - learning_rate: 3.0000e-04
Restoring model weights from the end of the best epoch: 30.
Fold 4: Evaluando el modelo...
--------------------------------------------------
--- FOLD 5/5 ---
--------------------------------------------------
Fold 5: No se aplicará remuestreo.
Fold 5: Construyendo y compilando un nuevo modelo...
Convirtiendo DataFrames a tensores para el entrenamiento...
Creando datasets de TensorFlow...
Epoch 1/30

Epoch 1: f1_score improved from -inf to 0.02029, saving model to model.weights.best.weights.h5
219/219 - 35s - 158ms/step - accuracy: 0.9103 - auc: 0.6097 - f1_score: 0.0203 - loss: 0.0812 - precision: 0.1421 - recall: 0.0109 - val_accuracy: 0.9150 - val_auc: 0.7184 - val_f1_score: 0.0000e+00 - val_loss: 0.0255 - val_precision: 0.0000e+00 - val_recall: 0.0000e+00 - learning_rate: 3.0000e-04
Epoch 2/30

Epoch 2: f1_score did not improve from 0.02029
219/219 - 24s - 111ms/step - accuracy: 0.9151 - auc: 0.6837 - f1_score: 0.0054 - loss: 0.0664 - precision: 0.6190 - recall: 0.0027 - val_accuracy: 0.9151 - val_auc: 0.7301 - val_f1_score: 0.0034 - val_loss: 0.0252 - val_precision: 1.0000 - val_recall: 0.0017 - learning_rate: 3.0000e-04
Epoch 3/30

Epoch 3: f1_score did not improve from 0.02029
219/219 - 24s - 109ms/step - accuracy: 0.9149 - auc: 0.7160 - f1_score: 0.0038 - loss: 0.0655 - precision: 0.4286 - recall: 0.0019 - val_accuracy: 0.9151 - val_auc: 0.7602 - val_f1_score: 0.0017 - val_loss: 0.0245 - val_precision: 1.0000 - val_recall: 8.4034e-04 - learning_rate: 3.0000e-04
Epoch 4/30

Epoch 4: f1_score did not improve from 0.02029

Epoch 4: ReduceLROnPlateau reducing learning rate to 0.0001500000071246177.
219/219 - 24s - 109ms/step - accuracy: 0.9153 - auc: 0.7596 - f1_score: 0.0125 - loss: 0.0644 - precision: 0.7143 - recall: 0.0063 - val_accuracy: 0.9155 - val_auc: 0.7976 - val_f1_score: 0.0117 - val_loss: 0.0233 - val_precision: 1.0000 - val_recall: 0.0059 - learning_rate: 3.0000e-04
Epoch 5/30

Epoch 5: f1_score improved from 0.02029 to 0.03175, saving model to model.weights.best.weights.h5
219/219 - 24s - 110ms/step - accuracy: 0.9161 - auc: 0.7889 - f1_score: 0.0317 - loss: 0.0635 - precision: 0.8462 - recall: 0.0162 - val_accuracy: 0.9158 - val_auc: 0.8044 - val_f1_score: 0.0183 - val_loss: 0.0231 - val_precision: 1.0000 - val_recall: 0.0092 - learning_rate: 1.5000e-04
Epoch 6/30

Epoch 6: f1_score improved from 0.03175 to 0.05890, saving model to model.weights.best.weights.h5
219/219 - 24s - 111ms/step - accuracy: 0.9172 - auc: 0.8132 - f1_score: 0.0589 - loss: 0.0627 - precision: 0.8841 - recall: 0.0305 - val_accuracy: 0.9168 - val_auc: 0.8325 - val_f1_score: 0.0412 - val_loss: 0.0223 - val_precision: 1.0000 - val_recall: 0.0210 - learning_rate: 1.5000e-04
Epoch 7/30

Epoch 7: f1_score improved from 0.05890 to 0.10139, saving model to model.weights.best.weights.h5
219/219 - 24s - 111ms/step - accuracy: 0.9190 - auc: 0.8363 - f1_score: 0.1014 - loss: 0.0617 - precision: 0.8828 - recall: 0.0538 - val_accuracy: 0.9202 - val_auc: 0.8660 - val_f1_score: 0.1212 - val_loss: 0.0206 - val_precision: 0.9506 - val_recall: 0.0647 - learning_rate: 1.5000e-04
Epoch 8/30

Epoch 8: f1_score improved from 0.10139 to 0.16858, saving model to model.weights.best.weights.h5
219/219 - 25s - 116ms/step - accuracy: 0.9223 - auc: 0.8571 - f1_score: 0.1686 - loss: 0.0605 - precision: 0.9343 - recall: 0.0926 - val_accuracy: 0.9263 - val_auc: 0.8843 - val_f1_score: 0.2609 - val_loss: 0.0191 - val_precision: 0.8878 - val_recall: 0.1529 - learning_rate: 1.5000e-04
Epoch 9/30

Epoch 9: f1_score improved from 0.16858 to 0.25813, saving model to model.weights.best.weights.h5
219/219 - 27s - 122ms/step - accuracy: 0.9267 - auc: 0.8733 - f1_score: 0.2581 - loss: 0.0596 - precision: 0.9249 - recall: 0.1500 - val_accuracy: 0.9296 - val_auc: 0.8972 - val_f1_score: 0.2997 - val_loss: 0.0184 - val_precision: 0.9679 - val_recall: 0.1773 - learning_rate: 1.5000e-04
Epoch 10/30

Epoch 10: f1_score improved from 0.25813 to 0.35017, saving model to model.weights.best.weights.h5
219/219 - 28s - 129ms/step - accuracy: 0.9320 - auc: 0.8793 - f1_score: 0.3502 - loss: 0.0589 - precision: 0.9327 - recall: 0.2155 - val_accuracy: 0.9341 - val_auc: 0.9017 - val_f1_score: 0.3665 - val_loss: 0.0179 - val_precision: 1.0000 - val_recall: 0.2244 - learning_rate: 1.5000e-04
Epoch 11/30

Epoch 11: f1_score improved from 0.35017 to 0.40112, saving model to model.weights.best.weights.h5
219/219 - 28s - 127ms/step - accuracy: 0.9352 - auc: 0.8866 - f1_score: 0.4011 - loss: 0.0582 - precision: 0.9361 - recall: 0.2553 - val_accuracy: 0.9393 - val_auc: 0.9075 - val_f1_score: 0.4444 - val_loss: 0.0169 - val_precision: 1.0000 - val_recall: 0.2857 - learning_rate: 1.5000e-04
Epoch 12/30

Epoch 12: f1_score improved from 0.40112 to 0.41383, saving model to model.weights.best.weights.h5
219/219 - 26s - 119ms/step - accuracy: 0.9361 - auc: 0.8927 - f1_score: 0.4138 - loss: 0.0578 - precision: 0.9397 - recall: 0.2653 - val_accuracy: 0.9361 - val_auc: 0.9169 - val_f1_score: 0.3973 - val_loss: 0.0172 - val_precision: 1.0000 - val_recall: 0.2479 - learning_rate: 1.5000e-04
Epoch 13/30

Epoch 13: f1_score improved from 0.41383 to 0.45060, saving model to model.weights.best.weights.h5
219/219 - 26s - 117ms/step - accuracy: 0.9390 - auc: 0.9035 - f1_score: 0.4506 - loss: 0.0570 - precision: 0.9629 - recall: 0.2941 - val_accuracy: 0.9363 - val_auc: 0.9248 - val_f1_score: 0.4005 - val_loss: 0.0165 - val_precision: 1.0000 - val_recall: 0.2504 - learning_rate: 1.5000e-04
Epoch 14/30

Epoch 14: f1_score improved from 0.45060 to 0.45402, saving model to model.weights.best.weights.h5
219/219 - 25s - 114ms/step - accuracy: 0.9393 - auc: 0.9086 - f1_score: 0.4540 - loss: 0.0566 - precision: 0.9671 - recall: 0.2966 - val_accuracy: 0.9383 - val_auc: 0.9289 - val_f1_score: 0.4301 - val_loss: 0.0155 - val_precision: 1.0000 - val_recall: 0.2739 - learning_rate: 1.5000e-04
Epoch 15/30

Epoch 15: f1_score improved from 0.45402 to 0.46793, saving model to model.weights.best.weights.h5
219/219 - 25s - 115ms/step - accuracy: 0.9403 - auc: 0.9171 - f1_score: 0.4679 - loss: 0.0561 - precision: 0.9652 - recall: 0.3088 - val_accuracy: 0.9362 - val_auc: 0.9300 - val_f1_score: 0.3995 - val_loss: 0.0159 - val_precision: 1.0000 - val_recall: 0.2496 - learning_rate: 1.5000e-04
Epoch 16/30

Epoch 16: f1_score improved from 0.46793 to 0.48598, saving model to model.weights.best.weights.h5
219/219 - 26s - 117ms/step - accuracy: 0.9417 - auc: 0.9208 - f1_score: 0.4860 - loss: 0.0555 - precision: 0.9723 - recall: 0.3239 - val_accuracy: 0.9408 - val_auc: 0.9352 - val_f1_score: 0.4665 - val_loss: 0.0146 - val_precision: 1.0000 - val_recall: 0.3042 - learning_rate: 1.5000e-04
Epoch 17/30

Epoch 17: f1_score did not improve from 0.48598
219/219 - 26s - 117ms/step - accuracy: 0.9412 - auc: 0.9216 - f1_score: 0.4808 - loss: 0.0556 - precision: 0.9652 - recall: 0.3202 - val_accuracy: 0.9389 - val_auc: 0.9340 - val_f1_score: 0.4393 - val_loss: 0.0153 - val_precision: 1.0000 - val_recall: 0.2815 - learning_rate: 1.5000e-04
Epoch 18/30

Epoch 18: f1_score did not improve from 0.48598
219/219 - 26s - 119ms/step - accuracy: 0.9411 - auc: 0.9260 - f1_score: 0.4785 - loss: 0.0554 - precision: 0.9656 - recall: 0.3181 - val_accuracy: 0.9406 - val_auc: 0.9348 - val_f1_score: 0.4635 - val_loss: 0.0148 - val_precision: 1.0000 - val_recall: 0.3017 - learning_rate: 1.5000e-04
Epoch 19/30

Epoch 19: f1_score improved from 0.48598 to 0.49538, saving model to model.weights.best.weights.h5
219/219 - 26s - 120ms/step - accuracy: 0.9425 - auc: 0.9302 - f1_score: 0.4954 - loss: 0.0549 - precision: 0.9741 - recall: 0.3321 - val_accuracy: 0.9382 - val_auc: 0.9402 - val_f1_score: 0.4290 - val_loss: 0.0157 - val_precision: 1.0000 - val_recall: 0.2731 - learning_rate: 1.5000e-04
Epoch 20/30

Epoch 20: f1_score improved from 0.49538 to 0.49828, saving model to model.weights.best.weights.h5
219/219 - 26s - 118ms/step - accuracy: 0.9426 - auc: 0.9336 - f1_score: 0.4983 - loss: 0.0547 - precision: 0.9714 - recall: 0.3351 - val_accuracy: 0.9392 - val_auc: 0.9442 - val_f1_score: 0.4434 - val_loss: 0.0166 - val_precision: 1.0000 - val_recall: 0.2849 - learning_rate: 1.5000e-04
Epoch 21/30

Epoch 21: f1_score did not improve from 0.49828
219/219 - 25s - 115ms/step - accuracy: 0.9421 - auc: 0.9354 - f1_score: 0.4934 - loss: 0.0547 - precision: 0.9640 - recall: 0.3315 - val_accuracy: 0.9394 - val_auc: 0.9505 - val_f1_score: 0.4465 - val_loss: 0.0146 - val_precision: 1.0000 - val_recall: 0.2874 - learning_rate: 1.5000e-04
Epoch 22/30

Epoch 22: f1_score improved from 0.49828 to 0.51707, saving model to model.weights.best.weights.h5
219/219 - 26s - 119ms/step - accuracy: 0.9439 - auc: 0.9384 - f1_score: 0.5171 - loss: 0.0542 - precision: 0.9650 - recall: 0.3532 - val_accuracy: 0.9391 - val_auc: 0.9524 - val_f1_score: 0.4421 - val_loss: 0.0135 - val_precision: 0.9971 - val_recall: 0.2840 - learning_rate: 1.5000e-04
Epoch 23/30

Epoch 23: f1_score improved from 0.51707 to 0.52588, saving model to model.weights.best.weights.h5
219/219 - 26s - 118ms/step - accuracy: 0.9445 - auc: 0.9438 - f1_score: 0.5259 - loss: 0.0539 - precision: 0.9625 - recall: 0.3618 - val_accuracy: 0.9441 - val_auc: 0.9569 - val_f1_score: 0.5103 - val_loss: 0.0125 - val_precision: 0.9976 - val_recall: 0.3429 - learning_rate: 1.5000e-04
Epoch 24/30

Epoch 24: f1_score improved from 0.52588 to 0.54827, saving model to model.weights.best.weights.h5
219/219 - 26s - 120ms/step - accuracy: 0.9463 - auc: 0.9464 - f1_score: 0.5483 - loss: 0.0536 - precision: 0.9605 - recall: 0.3836 - val_accuracy: 0.9377 - val_auc: 0.9586 - val_f1_score: 0.4218 - val_loss: 0.0156 - val_precision: 1.0000 - val_recall: 0.2672 - learning_rate: 1.5000e-04
Epoch 25/30

Epoch 25: f1_score improved from 0.54827 to 0.56237, saving model to model.weights.best.weights.h5
219/219 - 27s - 121ms/step - accuracy: 0.9472 - auc: 0.9483 - f1_score: 0.5624 - loss: 0.0533 - precision: 0.9538 - recall: 0.3987 - val_accuracy: 0.9411 - val_auc: 0.9599 - val_f1_score: 0.4704 - val_loss: 0.0132 - val_precision: 1.0000 - val_recall: 0.3076 - learning_rate: 1.5000e-04
Epoch 26/30

Epoch 26: f1_score improved from 0.56237 to 0.58638, saving model to model.weights.best.weights.h5
219/219 - 26s - 119ms/step - accuracy: 0.9493 - auc: 0.9517 - f1_score: 0.5864 - loss: 0.0529 - precision: 0.9581 - recall: 0.4225 - val_accuracy: 0.9422 - val_auc: 0.9621 - val_f1_score: 0.4857 - val_loss: 0.0142 - val_precision: 0.9974 - val_recall: 0.3210 - learning_rate: 1.5000e-04
Epoch 27/30

Epoch 27: f1_score improved from 0.58638 to 0.59329, saving model to model.weights.best.weights.h5
219/219 - 26s - 118ms/step - accuracy: 0.9498 - auc: 0.9524 - f1_score: 0.5933 - loss: 0.0527 - precision: 0.9522 - recall: 0.4309 - val_accuracy: 0.9413 - val_auc: 0.9622 - val_f1_score: 0.4734 - val_loss: 0.0130 - val_precision: 1.0000 - val_recall: 0.3101 - learning_rate: 1.5000e-04
Epoch 28/30

Epoch 28: f1_score improved from 0.59329 to 0.60622, saving model to model.weights.best.weights.h5
219/219 - 27s - 124ms/step - accuracy: 0.9509 - auc: 0.9547 - f1_score: 0.6062 - loss: 0.0525 - precision: 0.9527 - recall: 0.4445 - val_accuracy: 0.9379 - val_auc: 0.9648 - val_f1_score: 0.4249 - val_loss: 0.0146 - val_precision: 1.0000 - val_recall: 0.2697 - learning_rate: 1.5000e-04
Epoch 29/30

Epoch 29: f1_score improved from 0.60622 to 0.61655, saving model to model.weights.best.weights.h5
219/219 - 27s - 125ms/step - accuracy: 0.9520 - auc: 0.9551 - f1_score: 0.6165 - loss: 0.0523 - precision: 0.9604 - recall: 0.4540 - val_accuracy: 0.9398 - val_auc: 0.9629 - val_f1_score: 0.4515 - val_loss: 0.0152 - val_precision: 1.0000 - val_recall: 0.2916 - learning_rate: 1.5000e-04
Epoch 30/30

Epoch 30: f1_score improved from 0.61655 to 0.62227, saving model to model.weights.best.weights.h5
219/219 - 27s - 123ms/step - accuracy: 0.9525 - auc: 0.9555 - f1_score: 0.6223 - loss: 0.0524 - precision: 0.9601 - recall: 0.4603 - val_accuracy: 0.9453 - val_auc: 0.9640 - val_f1_score: 0.5260 - val_loss: 0.0131 - val_precision: 0.9977 - val_recall: 0.3571 - learning_rate: 1.5000e-04
Restoring model weights from the end of the best epoch: 30.
Fold 5: Evaluando el modelo...

==================================================
Resumen de la Validación Cruzada
==================================================
                  Mean    Std Dev
Precision      0.97820   0.039004
Recall         0.51124   0.082690
F1-Score       0.66596   0.063479
Accuracy       0.95712   0.005607
ROC-AUC        0.96780   0.002449
TN         12790.24000  35.123923
TP           608.32000  98.399153
FP            17.76000  35.123923
FN           581.68000  98.399153

Análisis detallado por fold:
    Threshold  Precision  Recall  F1-Score  Accuracy  ROC-AUC     TN   TP  \
0        0.30      0.854   0.681     0.757     0.963    0.969  12669  810   
1        0.35      0.962   0.602     0.740     0.964    0.969  12780  716   
2        0.40      0.993   0.567     0.722     0.963    0.969  12803  675   
3        0.45      0.998   0.530     0.693     0.960    0.969  12807  631   
4        0.50      0.998   0.512     0.677     0.958    0.969  12807  609   
5        0.30      0.992   0.521     0.683     0.959    0.966  12803  620   
6        0.35      0.998   0.481     0.649     0.956    0.966  12807  572   
7        0.40      1.000   0.450     0.620     0.953    0.966  12808  535   
8        0.45      1.000   0.426     0.598     0.951    0.966  12808  507   
9        0.50      1.000   0.404     0.576     0.949    0.966  12808  481   
10       0.30      0.884   0.659     0.755     0.964    0.970  12705  784   
11       0.35      0.969   0.598     0.740     0.964    0.970  12785  712   
12       0.40      0.999   0.561     0.719     0.963    0.970  12807  668   
13       0.45      1.000   0.521     0.685     0.959    0.970  12808  620   
14       0.50      1.000   0.495     0.662     0.957    0.970  12808  589   
15       0.30      0.931   0.604     0.733     0.963    0.970  12755  719   
16       0.35      0.988   0.533     0.692     0.960    0.970  12800  634   
17       0.40      0.998   0.486     0.653     0.956    0.970  12807  578   
18       0.45      1.000   0.453     0.623     0.953    0.970  12808  539   
19       0.50      1.000   0.427     0.598     0.951    0.970  12808  508   
20       0.30      0.925   0.584     0.716     0.961    0.964  12752  695   
21       0.35      0.978   0.491     0.654     0.956    0.964  12795  584   
22       0.40      0.992   0.443     0.612     0.952    0.964  12804  527   
23       0.45      0.998   0.395     0.566     0.948    0.964  12807  470   
24       0.50      0.998   0.357     0.526     0.945    0.964  12807  425   

     FP   FN  fold  
0   139  380     1  
1    28  474     1  
2     5  515     1  
3     1  559     1  
4     1  581     1  
5     5  570     2  
6     1  618     2  
7     0  655     2  
8     0  683     2  
9     0  709     2  
10  103  406     3  
11   23  478     3  
12    1  522     3  
13    0  570     3  
14    0  601     3  
15   53  471     4  
16    8  556     4  
17    1  612     4  
18    0  651     4  
19    0  682     4  
20   56  495     5  
21   13  606     5  
22    4  663     5  
23    1  720     5  
24    1  765     5  
</pre></div>
</div>
</div>
</div>
<p>Calibrar conformal (split-conformal sobre cal_df):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 3. División y Procesamiento de Datos ---</span>

<span class="c1"># Dividir el conjunto train en entrenamiento (80%) y calibración (20%) para la calibración.</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_cal</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_cal</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># 2. Ajustar el codificador SOLO con los datos de entrenamiento (X_train)</span>
<span class="c1">#    y transformar X_train.</span>
<span class="n">X_train</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">])</span>

<span class="c1">#  Transformar X_cal y X_test usando el encoder YA AJUSTADO. Es crucial no volver a hacer &#39;fit&#39;.</span>
<span class="n">X_cal</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_cal</span><span class="p">[</span><span class="n">categorical_cols</span><span class="p">])</span>



<span class="c1"># Crear el DataFrame de entrenamiento completo</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_df</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span>

<span class="c1"># Crear el DataFrame de calibración completo</span>
<span class="n">cal_df</span> <span class="o">=</span> <span class="n">X_cal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cal_df</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_cal</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tamaños:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train:</span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calibración:</span><span class="si">{</span><span class="n">X_cal</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tamaños:
Train:(48993, 15)
Calibración:(20997, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.spartan</span><span class="w"> </span><span class="kn">import</span> <span class="n">conformal</span>
<span class="c1"># --- PASO 4: CALIBRACIÓN CONFORMAL ---</span>

<span class="c1"># Usar el conjunto de calibración para encontrar un umbral de decisión con garantías estadísticas.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Paso 4: Realizando la calibración conformal...&quot;</span><span class="p">)</span>
<span class="n">ALPHA</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># Nivel de error aceptable (queremos un 90% de confianza)</span>

<span class="c1"># 1. Recibe el diccionario completo en una sola variable</span>
<span class="n">qhat_dict</span> <span class="o">=</span> <span class="n">conformal</span><span class="o">.</span><span class="n">calibrate_conformal_conditional</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span>
    <span class="n">df_cal</span><span class="o">=</span><span class="n">cal_df</span><span class="p">,</span>
    <span class="n">cont_cols</span><span class="o">=</span><span class="n">numerical_cols</span><span class="p">,</span>
    <span class="n">bin_cols</span><span class="o">=</span><span class="n">binary_cols</span><span class="p">,</span>
    <span class="n">cat_cols</span><span class="o">=</span><span class="n">categorical_cols</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="n">TARGET_COL</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span>
<span class="p">)</span>

<span class="c1"># 2. Extrae los valores numéricos del diccionario</span>
<span class="n">qhat_0</span> <span class="o">=</span> <span class="n">qhat_dict</span><span class="p">[</span><span class="s2">&quot;qhat_0&quot;</span><span class="p">]</span>
<span class="n">qhat_1</span> <span class="o">=</span> <span class="n">qhat_dict</span><span class="p">[</span><span class="s2">&quot;qhat_1&quot;</span><span class="p">]</span>

<span class="c1"># 3. Ahora puedes imprimir los valores numéricos correctamente</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nivel de error alpha: </span><span class="si">{</span><span class="n">ALPHA</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cuantil para la clase negativa (qhat_0): </span><span class="si">{</span><span class="n">qhat_0</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cuantil para la clase positiva (qhat_1): </span><span class="si">{</span><span class="n">qhat_1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Opcional: Calcula y muestra los umbrales de decisión finales</span>
<span class="c1"># según la documentación de tu propia función</span>
<span class="n">umbral_decision_negativo</span> <span class="o">=</span> <span class="n">qhat_0</span>
<span class="n">umbral_decision_positivo</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">qhat_1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Umbral de decisión para clase negativa (p &lt;= qhat_0): </span><span class="si">{</span><span class="n">umbral_decision_negativo</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Umbral de decisión para clase positiva (p &gt;= 1 - qhat_1): </span><span class="si">{</span><span class="n">umbral_decision_positivo</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Paso 4: Realizando la calibración conformal...
Nivel de error alpha: 0.1
Cuantil para la clase negativa (qhat_0): 0.1751
Cuantil para la clase positiva (qhat_1): 0.8168
------------------------------
Umbral de decisión para clase negativa (p &lt;= qhat_0): 0.1751
Umbral de decisión para clase positiva (p &gt;= 1 - qhat_1): 0.1832
</pre></div>
</div>
</div>
</div>
<p>Evaluar en el conjunto test:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- PASO 5: EVALUACIÓN FINAL EN EL CONJUNTO DE PRUEBA ---</span>
<span class="c1"># Evaluar el rendimiento del modelo en datos nunca antes vistos.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Paso 5: Evaluando el modelo en el conjunto de prueba...&quot;</span><span class="p">)</span>
<span class="c1"># Primero, preparamos el df_test completo</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_test</span><span class="p">[</span><span class="n">TARGET_COL</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tamaño dataset test:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train:</span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Evaluar con el umbral estándar de 0.5 como línea base</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Evaluación con umbral estándar de 0.5 ---&quot;</span><span class="p">)</span>
<span class="n">conformal_metrics</span> <span class="o">=</span> <span class="n">conformal</span><span class="o">.</span><span class="n">evaluate_conformal_sets</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">best_model</span><span class="p">,</span>
    <span class="n">df_test</span><span class="o">=</span><span class="n">df_test</span><span class="p">,</span>
    <span class="n">cont_cols</span><span class="o">=</span><span class="n">numerical_cols</span><span class="p">,</span>
    <span class="n">bin_cols</span><span class="o">=</span><span class="n">binary_cols</span><span class="p">,</span>
    <span class="n">cat_cols</span><span class="o">=</span><span class="n">categorical_cols</span><span class="p">,</span>
    <span class="n">target_col</span><span class="o">=</span><span class="n">TARGET_COL</span><span class="p">,</span>
    <span class="n">qhats</span><span class="o">=</span><span class="n">qhat_dict</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conformal_metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Paso 5: Evaluando el modelo en el conjunto de prueba...
Tamaño dataset test:
Train:(29996, 15)

--- Evaluación con umbral estándar de 0.5 ---
{&#39;coverage&#39;: 0.8932190958794506, &#39;average_set_size&#39;: 0.9879650620082677}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="evaluacion-de-metricas-de-performance">
<h1>Evaluación de Métricas de Performance<a class="headerlink" href="#evaluacion-de-metricas-de-performance" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">35</span> <span class="o">+</span> <span class="s2">&quot;TABLA COMPARATIVA DE RESULTADOS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">results_balanced_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>====================================================================================================
                                   TABLA COMPARATIVA DE RESULTADOS
====================================================================================================
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
</style>
<table id="T_1c5cf">
  <thead>
    <tr>
      <th id="T_1c5cf_level0_col0" class="col_heading level0 col0" >Model</th>
      <th id="T_1c5cf_level0_col1" class="col_heading level0 col1" >Precision</th>
      <th id="T_1c5cf_level0_col2" class="col_heading level0 col2" >Recall</th>
      <th id="T_1c5cf_level0_col3" class="col_heading level0 col3" >F1-Score</th>
      <th id="T_1c5cf_level0_col4" class="col_heading level0 col4" >Accuracy</th>
      <th id="T_1c5cf_level0_col5" class="col_heading level0 col5" >ROC-AUC</th>
      <th id="T_1c5cf_level0_col6" class="col_heading level0 col6" >Best Params</th>
      <th id="T_1c5cf_level0_col7" class="col_heading level0 col7" >TN</th>
      <th id="T_1c5cf_level0_col8" class="col_heading level0 col8" >TP</th>
      <th id="T_1c5cf_level0_col9" class="col_heading level0 col9" >FP</th>
      <th id="T_1c5cf_level0_col10" class="col_heading level0 col10" >FN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_1c5cf_row0_col0" class="data row0 col0" >KNN</td>
      <td id="T_1c5cf_row0_col1" class="data row0 col1" >0.987</td>
      <td id="T_1c5cf_row0_col2" class="data row0 col2" >0.522</td>
      <td id="T_1c5cf_row0_col3" class="data row0 col3" >0.683</td>
      <td id="T_1c5cf_row0_col4" class="data row0 col4" >0.959</td>
      <td id="T_1c5cf_row0_col5" class="data row0 col5" >0.929</td>
      <td id="T_1c5cf_row0_col6" class="data row0 col6" >{'metric': 'euclidean', 'n_neighbors': 15, 'weights': 'distance'}</td>
      <td id="T_1c5cf_row0_col7" class="data row0 col7" >27428</td>
      <td id="T_1c5cf_row0_col8" class="data row0 col8" >1331</td>
      <td id="T_1c5cf_row0_col9" class="data row0 col9" >18</td>
      <td id="T_1c5cf_row0_col10" class="data row0 col10" >1219</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row1_col0" class="data row1 col0" >LogisticRegression</td>
      <td id="T_1c5cf_row1_col1" class="data row1 col1" >0.875</td>
      <td id="T_1c5cf_row1_col2" class="data row1 col2" >0.628</td>
      <td id="T_1c5cf_row1_col3" class="data row1 col3" >0.732</td>
      <td id="T_1c5cf_row1_col4" class="data row1 col4" >0.961</td>
      <td id="T_1c5cf_row1_col5" class="data row1 col5" >0.960</td>
      <td id="T_1c5cf_row1_col6" class="data row1 col6" >{'C': 0.1, 'penalty': 'l1', 'solver': 'liblinear'}</td>
      <td id="T_1c5cf_row1_col7" class="data row1 col7" >27218</td>
      <td id="T_1c5cf_row1_col8" class="data row1 col8" >1602</td>
      <td id="T_1c5cf_row1_col9" class="data row1 col9" >228</td>
      <td id="T_1c5cf_row1_col10" class="data row1 col10" >948</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row2_col0" class="data row2 col0" >DecisionTree</td>
      <td id="T_1c5cf_row2_col1" class="data row2 col1" >0.972</td>
      <td id="T_1c5cf_row2_col2" class="data row2 col2" >0.676</td>
      <td id="T_1c5cf_row2_col3" class="data row2 col3" >0.798</td>
      <td id="T_1c5cf_row2_col4" class="data row2 col4" >0.971</td>
      <td id="T_1c5cf_row2_col5" class="data row2 col5" >0.974</td>
      <td id="T_1c5cf_row2_col6" class="data row2 col6" >{'max_depth': 10, 'min_samples_leaf': 1, 'min_samples_split': 10}</td>
      <td id="T_1c5cf_row2_col7" class="data row2 col7" >27397</td>
      <td id="T_1c5cf_row2_col8" class="data row2 col8" >1725</td>
      <td id="T_1c5cf_row2_col9" class="data row2 col9" >49</td>
      <td id="T_1c5cf_row2_col10" class="data row2 col10" >825</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row3_col0" class="data row3 col0" >RandomForest</td>
      <td id="T_1c5cf_row3_col1" class="data row3 col1" >0.998</td>
      <td id="T_1c5cf_row3_col2" class="data row3 col2" >0.667</td>
      <td id="T_1c5cf_row3_col3" class="data row3 col3" >0.799</td>
      <td id="T_1c5cf_row3_col4" class="data row3 col4" >0.972</td>
      <td id="T_1c5cf_row3_col5" class="data row3 col5" >0.964</td>
      <td id="T_1c5cf_row3_col6" class="data row3 col6" >{'max_depth': None, 'min_samples_split': 10, 'n_estimators': 300}</td>
      <td id="T_1c5cf_row3_col7" class="data row3 col7" >27443</td>
      <td id="T_1c5cf_row3_col8" class="data row3 col8" >1700</td>
      <td id="T_1c5cf_row3_col9" class="data row3 col9" >3</td>
      <td id="T_1c5cf_row3_col10" class="data row3 col10" >850</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row4_col0" class="data row4 col0" >XGBoost</td>
      <td id="T_1c5cf_row4_col1" class="data row4 col1" >0.985</td>
      <td id="T_1c5cf_row4_col2" class="data row4 col2" >0.677</td>
      <td id="T_1c5cf_row4_col3" class="data row4 col3" >0.803</td>
      <td id="T_1c5cf_row4_col4" class="data row4 col4" >0.972</td>
      <td id="T_1c5cf_row4_col5" class="data row4 col5" >0.978</td>
      <td id="T_1c5cf_row4_col6" class="data row4 col6" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
      <td id="T_1c5cf_row4_col7" class="data row4 col7" >27420</td>
      <td id="T_1c5cf_row4_col8" class="data row4 col8" >1727</td>
      <td id="T_1c5cf_row4_col9" class="data row4 col9" >26</td>
      <td id="T_1c5cf_row4_col10" class="data row4 col10" >823</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row5_col0" class="data row5 col0" >SVM</td>
      <td id="T_1c5cf_row5_col1" class="data row5 col1" >0.922</td>
      <td id="T_1c5cf_row5_col2" class="data row5 col2" >0.597</td>
      <td id="T_1c5cf_row5_col3" class="data row5 col3" >0.725</td>
      <td id="T_1c5cf_row5_col4" class="data row5 col4" >0.961</td>
      <td id="T_1c5cf_row5_col5" class="data row5 col5" >0.959</td>
      <td id="T_1c5cf_row5_col6" class="data row5 col6" >{'C': 10, 'gamma': 'scale', 'kernel': 'linear'}</td>
      <td id="T_1c5cf_row5_col7" class="data row5 col7" >27318</td>
      <td id="T_1c5cf_row5_col8" class="data row5 col8" >1522</td>
      <td id="T_1c5cf_row5_col9" class="data row5 col9" >128</td>
      <td id="T_1c5cf_row5_col10" class="data row5 col10" >1028</td>
    </tr>
    <tr>
      <td id="T_1c5cf_row6_col0" class="data row6 col0" >MLP</td>
      <td id="T_1c5cf_row6_col1" class="data row6 col1" >0.963</td>
      <td id="T_1c5cf_row6_col2" class="data row6 col2" >0.678</td>
      <td id="T_1c5cf_row6_col3" class="data row6 col3" >0.796</td>
      <td id="T_1c5cf_row6_col4" class="data row6 col4" >0.970</td>
      <td id="T_1c5cf_row6_col5" class="data row6 col5" >0.971</td>
      <td id="T_1c5cf_row6_col6" class="data row6 col6" >{'activation': 'relu', 'alpha': 0.01, 'hidden_layer_sizes': (50,), 'solver': 'adam'}</td>
      <td id="T_1c5cf_row6_col7" class="data row6 col7" >27380</td>
      <td id="T_1c5cf_row6_col8" class="data row6 col8" >1728</td>
      <td id="T_1c5cf_row6_col9" class="data row6 col9" >66</td>
      <td id="T_1c5cf_row6_col10" class="data row6 col10" >822</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Agrupar por métrica y seleccionar el índice del máximo en la columna &#39;Valor&#39;</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">best_config_balanced_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Métrica&quot;</span><span class="p">)[</span><span class="s2">&quot;Valor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>

<span class="c1"># Filtrar el DataFrame con esos índices</span>
<span class="n">best_overall_balanced_df</span> <span class="o">=</span> <span class="n">best_config_balanced_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">35</span> <span class="o">+</span> <span class="s2">&quot;TABLA COMPARATIVA DE RESULTADOS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">best_overall_balanced_df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">({</span>
    <span class="s2">&quot;Precision&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Recall&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F1-Score&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ROC-AUC&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>====================================================================================================
                                   TABLA COMPARATIVA DE RESULTADOS
====================================================================================================
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
</style>
<table id="T_25bad">
  <thead>
    <tr>
      <th id="T_25bad_level0_col0" class="col_heading level0 col0" >Modelo</th>
      <th id="T_25bad_level0_col1" class="col_heading level0 col1" >Métrica</th>
      <th id="T_25bad_level0_col2" class="col_heading level0 col2" >Valor</th>
      <th id="T_25bad_level0_col3" class="col_heading level0 col3" >Parámetros</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_25bad_row0_col0" class="data row0 col0" >XGBoost</td>
      <td id="T_25bad_row0_col1" class="data row0 col1" >Accuracy</td>
      <td id="T_25bad_row0_col2" class="data row0 col2" >0.971696</td>
      <td id="T_25bad_row0_col3" class="data row0 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_25bad_row1_col0" class="data row1 col0" >XGBoost</td>
      <td id="T_25bad_row1_col1" class="data row1 col1" >F1-Score</td>
      <td id="T_25bad_row1_col2" class="data row1 col2" >0.802696</td>
      <td id="T_25bad_row1_col3" class="data row1 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_25bad_row2_col0" class="data row2 col0" >RandomForest</td>
      <td id="T_25bad_row2_col1" class="data row2 col1" >Precision</td>
      <td id="T_25bad_row2_col2" class="data row2 col2" >0.998238</td>
      <td id="T_25bad_row2_col3" class="data row2 col3" >{'max_depth': None, 'min_samples_split': 10, 'n_estimators': 300}</td>
    </tr>
    <tr>
      <td id="T_25bad_row3_col0" class="data row3 col0" >XGBoost</td>
      <td id="T_25bad_row3_col1" class="data row3 col1" >ROC-AUC</td>
      <td id="T_25bad_row3_col2" class="data row3 col2" >0.978170</td>
      <td id="T_25bad_row3_col3" class="data row3 col3" >{'learning_rate': 0.2, 'max_depth': 3, 'n_estimators': 100, 'subsample': 1.0}</td>
    </tr>
    <tr>
      <td id="T_25bad_row4_col0" class="data row4 col0" >MLP</td>
      <td id="T_25bad_row4_col1" class="data row4 col1" >Recall</td>
      <td id="T_25bad_row4_col2" class="data row4 col2" >0.677647</td>
      <td id="T_25bad_row4_col3" class="data row4 col3" >{'activation': 'relu', 'alpha': 0.01, 'hidden_layer_sizes': (50,), 'solver': 'adam'}</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./c03_proyectoFinal"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="diabetes_classifier_eda.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">EDA- PROYECTO FINAL</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Implementación de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-y-preprocesamiento-de-datos">Carga y Preprocesamiento de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia">Metodología</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#especificacion-del-grid-de-hiperparametros-por-tipo-de-modelo">Especificación del Grid de Hiperparámetros por Tipo de Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento-algoritmos-clasicos">Entrenamiento: Algoritmos Clásicos</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-y-benchmark">Resultados y <em>Benchmark</em></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-metricas-de-performance">Evaluación de Métricas de Performance</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>